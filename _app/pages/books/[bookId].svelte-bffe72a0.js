import{Q as t,S as e,i as n,s as o,e as a,c as s,a as r,d as l,f as c,I as i,z as u,V as d,b as f,B as h,r as m,u as p,v as b,t as v,g,G as $,D as k,l as x,j as w,k as E,m as I,n as y,o as T,w as _,W as D,L as V,X as j,C,R as P,Y as B,Z as N,h as O,M as L,N as S,O as q,_ as A,J as H}from"../../chunks/vendor-60c255d9.js";import{p as M,g as R,b as z}from"../../chunks/books-4641d48a.js";import{_ as F}from"../../chunks/preload-helper-9f12a5fd.js";var G;(G||(G={})).Text="text";const J=M("blocks",{table:new t.Table});function Q(e,n){let o;return J.change((({table:a})=>{const s={bookId:e,type:n};var r;null!==(r=s)&&"object"==typeof r&&r.type===G.Text&&(s.text=new t.Text),o=a.add(s)})),o}function U(t){let e;return{c(){e=a("div")},l(t){e=s(t,"DIV",{}),r(e).forEach(l)},m(n,o){c(n,e,o),t[5](e)},p:i,i:i,o:i,d(n){n&&l(e),t[5](null)}}}function W(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(a,s){function r(t){try{c(o.next(t))}catch(e){s(e)}}function l(t){try{c(o.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,l)}c((o=o.apply(t,e||[])).next())}))};let a,s,r,{text:l}=e,{onTextChange:c}=e;return u((()=>o(void 0,void 0,void 0,(function*(){const{default:t}=yield F((()=>import("../../chunks/quill-78bef24f.js").then((function(t){return t.q}))),["/_app/chunks/quill-78bef24f.js","/_app/chunks/vendor-60c255d9.js"]);n(4,s=new t(r,{modules:{toolbar:!1},theme:"snow"})),l&&s.setText(l),s.on("text-change",(function(t,e,n){"user"===n&&c(t)})),r.addEventListener("keydown",(function(t){if("Backspace"===t.key){const e=s.getText();""!==e&&"\n"!==e&&t.stopPropagation()}}),{capture:!0})})))),t.$$set=t=>{"text"in t&&n(1,l=t.text),"onTextChange"in t&&n(2,c=t.onTextChange)},t.$$.update=()=>{26&t.$$.dirty&&l!==a&&s&&(n(3,a=l),s.setText(l))},[r,l,c,a,s,function(t){d[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class X extends e{constructor(t){super(),n(this,t,W,U,o,{text:1,onTextChange:2})}}function Y(t){let e,n,o;return{c(){e=a("div"),n=a("h1"),o=v("Click to Edit"),this.h()},l(t){e=s(t,"DIV",{class:!0});var a=r(e);n=s(a,"H1",{});var c=r(n);o=g(c,"Click to Edit"),c.forEach(l),a.forEach(l),this.h()},h(){f(e,"class","d-flex align-items-center justify-content-center")},m(t,a){c(t,e,a),$(e,n),$(n,o)},p:i,i:i,o:i,d(t){t&&l(e)}}}function Z(t){let e,n,o=k.markdown(t[2])+"";return{c(){n=x(),this.h()},l(t){n=x(),this.h()},h(){e=new D(n)},m(t,a){e.m(o,t,a),c(t,n,a)},p(t,n){4&n&&o!==(o=k.markdown(t[2])+"")&&e.p(o)},i:i,o:i,d(t){t&&l(n),t&&e.d()}}}function K(t){let e,n,o,i,u,d,h=k.markdown(t[3])+"";return o=new X({props:{text:t[2],onTextChange:t[4]}}),{c(){e=a("div"),n=a("div"),w(o.$$.fragment),i=E(),u=a("div"),this.h()},l(t){e=s(t,"DIV",{class:!0});var a=r(e);n=s(a,"DIV",{class:!0});var c=r(n);I(o.$$.fragment,c),c.forEach(l),i=y(a),u=s(a,"DIV",{class:!0}),r(u).forEach(l),a.forEach(l),this.h()},h(){f(n,"class","col-6"),f(u,"class","col-6"),f(e,"class","row")},m(t,a){c(t,e,a),$(e,n),T(o,n,null),$(e,i),$(e,u),u.innerHTML=h,d=!0},p(t,e){const n={};4&e&&(n.text=t[2]),o.$set(n),(!d||8&e)&&h!==(h=k.markdown(t[3])+"")&&(u.innerHTML=h)},i(t){d||(b(o.$$.fragment,t),d=!0)},o(t){m(o.$$.fragment,t),d=!1},d(t){t&&l(e),_(o)}}}function tt(t){let e,n,o,i,u,d;const v=[K,Z,Y],g=[];function $(t,e){return t[1]?0:(4&e&&(n=!!t[2].trim()),n?1:2)}return o=$(t,-1),i=g[o]=v[o](t),{c(){e=a("div"),i.c(),this.h()},l(t){e=s(t,"DIV",{id:!0});var n=r(e);i.l(n),n.forEach(l),this.h()},h(){f(e,"id",u=t[0].id)},m(t,n){c(t,e,n),g[o].m(e,null),d=!0},p(t,[n]){let a=o;o=$(t,n),o===a?g[o].p(t,n):(h(),m(g[a],1,1,(()=>{g[a]=null})),p(),i=g[o],i?i.p(t,n):(i=g[o]=v[o](t),i.c()),b(i,1),i.m(e,null)),(!d||1&n&&u!==(u=t[0].id))&&f(e,"id",u)},i(t){d||(b(i),d=!0)},o(t){m(i),d=!1},d(t){t&&l(e),g[o].d()}}}function et(t,e,n){let o,{block:a}=e,{edit:s}=e,r=a.text.toString(),l=r;return t.$$set=t=>{"block"in t&&n(0,a=t.block),"edit"in t&&n(1,s=t.edit)},t.$$.update=()=>{39&t.$$.dirty&&s!==o&&(n(5,o=s),n(2,r=a.text.toString()),n(3,l=r))},[a,s,r,l,function(t){var e,o;e=a.id,o=e=>{!function(t,e){let n=0;e.forEach(((e,o)=>{if(e.retain&&(n+=e.retain),"string"==typeof e.insert){const o=e.insert.split("");t.insertAt(n,...o),n+=o.length}else e.delete&&t.deleteAt(n,e.delete)}))}(e.text,t),n(3,l=e.text.toString())},J.change((({table:t})=>{const n=t.byId(e);n&&o(n)}))},o]}class nt extends e{constructor(t){super(),n(this,t,et,tt,o,{block:0,edit:1})}}function ot(t){let e,n;return e=new nt({props:{block:t[0],edit:t[1]}}),{c(){w(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,o){T(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.block=t[0]),2&n&&(o.edit=t[1]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){_(e,t)}}}function at(t){let e,n,o,i,u=t[0].type===G.Text&&ot(t);return{c(){e=a("div"),u&&u.c(),this.h()},l(t){e=s(t,"DIV",{class:!0});var n=r(e);u&&u.l(n),n.forEach(l),this.h()},h(){f(e,"class","mb-4")},m(a,s){c(a,e,s),u&&u.m(e,null),n=!0,o||(i=V(e,"click",j(t[2])),o=!0)},p(t,[n]){t[0].type===G.Text?u?(u.p(t,n),1&n&&b(u,1)):(u=ot(t),u.c(),b(u,1),u.m(e,null)):u&&(h(),m(u,1,1,(()=>{u=null})),p())},i(t){n||(b(u),n=!0)},o(t){m(u),n=!1},d(t){t&&l(e),u&&u.d(),o=!1,i()}}}function st(t,e,n){let o,{block:a}=e;u((()=>{window.addEventListener("click",(()=>n(1,o=!1)))}));return t.$$set=t=>{"block"in t&&n(0,a=t.block)},[a,o,()=>n(1,o=!0)]}class rt extends e{constructor(t){super(),n(this,t,st,at,o,{block:0})}}const lt=C(null),ct={subscribe:lt.subscribe,get:()=>P(lt)},it=[];function ut(t,e,n){const o=t.slice();return o[6]=e[n][0],o[7]=e[n][1],o}function dt(t,e,n){const o=t.slice();return o[10]=e[n],o}function ft(t){let e,n;return e=new rt({props:{block:t[10]}}),{c(){w(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,o){T(e,t,o),n=!0},p(t,n){const o={};8&n&&(o.block=t[10]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){_(e,t)}}}function ht(t){let e,n,o=t[6]+"";return{c(){e=a("option"),n=v(o),this.h()},l(t){e=s(t,"OPTION",{value:!0});var a=r(e);n=g(a,o),a.forEach(l),this.h()},h(){e.__value=t[7],e.value=e.__value},m(t,o){c(t,e,o),$(e,n)},p:i,d(t){t&&l(e)}}}function mt(t){var e;let n,o,i,u,d,k,x,w,I,T,_,D,j,C,P,q,A,H,M,R,z=t[0].name+"",F=(null==(e=t[2])?void 0:e.getId())+"",J=t[3].table.rows,Q=[];for(let a=0;a<J.length;a+=1)Q[a]=ft(dt(t,J,a));const U=t=>m(Q[t],1,1,(()=>{Q[t]=null}));let W=Object.entries(G),X=[];for(let a=0;a<W.length;a+=1)X[a]=ht(ut(t,W,a));return{c(){n=a("h1"),o=v(z),i=E(),u=a("p"),d=v("PeerId: "),k=v(F),x=E(),w=a("div");for(let t=0;t<Q.length;t+=1)Q[t].c();I=E(),T=a("div"),_=a("form"),D=a("div"),j=a("select");for(let t=0;t<X.length;t+=1)X[t].c();C=E(),P=a("div"),q=a("button"),A=v("Create"),this.h()},l(t){n=s(t,"H1",{});var e=r(n);o=g(e,z),e.forEach(l),i=y(t),u=s(t,"P",{});var a=r(u);d=g(a,"PeerId: "),k=g(a,F),a.forEach(l),x=y(t),w=s(t,"DIV",{class:!0});var c=r(w);for(let n=0;n<Q.length;n+=1)Q[n].l(c);c.forEach(l),I=y(t),T=s(t,"DIV",{class:!0});var f=r(T);_=s(f,"FORM",{action:!0,class:!0});var h=r(_);D=s(h,"DIV",{class:!0});var m=r(D);j=s(m,"SELECT",{class:!0,placeholder:!0,"aria-label":!0,required:!0});var p=r(j);for(let n=0;n<X.length;n+=1)X[n].l(p);p.forEach(l),m.forEach(l),C=y(h),P=s(h,"DIV",{class:!0});var b=r(P);q=s(b,"BUTTON",{type:!0,class:!0,"aria-label":!0});var v=r(q);A=g(v,"Create"),v.forEach(l),b.forEach(l),h.forEach(l),f.forEach(l),this.h()},h(){f(w,"class","mt-4"),f(j,"class","form-select"),f(j,"placeholder","New Book Name"),f(j,"aria-label","New Book Name"),j.required=!0,void 0===t[1]&&B((()=>t[5].call(j))),f(D,"class","col-auto"),f(q,"type","submit"),f(q,"class","btn btn-primary"),f(q,"aria-label","Create Block"),f(P,"class","col-auto"),f(_,"action","javascript:void(0);"),f(_,"class","row mt-4"),f(T,"class","d-flex align-items-center justify-content-center")},m(e,a){c(e,n,a),$(n,o),c(e,i,a),c(e,u,a),$(u,d),$(u,k),c(e,x,a),c(e,w,a);for(let t=0;t<Q.length;t+=1)Q[t].m(w,null);c(e,I,a),c(e,T,a),$(T,_),$(_,D),$(D,j);for(let t=0;t<X.length;t+=1)X[t].m(j,null);N(j,t[1]),$(_,C),$(_,P),$(P,q),$(q,A),H=!0,M||(R=[V(j,"change",t[5]),V(q,"click",t[4])],M=!0)},p(t,[e]){var n;if((!H||1&e)&&z!==(z=t[0].name+"")&&O(o,z),(!H||4&e)&&F!==(F=(null==(n=t[2])?void 0:n.getId())+"")&&O(k,F),8&e){let n;for(J=t[3].table.rows,n=0;n<J.length;n+=1){const o=dt(t,J,n);Q[n]?(Q[n].p(o,e),b(Q[n],1)):(Q[n]=ft(o),Q[n].c(),b(Q[n],1),Q[n].m(w,null))}for(h(),n=J.length;n<Q.length;n+=1)U(n);p()}if(0&e){let n;for(W=Object.entries(G),n=0;n<W.length;n+=1){const o=ut(t,W,n);X[n]?X[n].p(o,e):(X[n]=ht(o),X[n].c(),X[n].m(j,null))}for(;n<X.length;n+=1)X[n].d(1);X.length=W.length}2&e&&N(j,t[1])},i(t){if(!H){for(let t=0;t<J.length;t+=1)b(Q[t]);H=!0}},o(t){Q=Q.filter(Boolean);for(let e=0;e<Q.length;e+=1)m(Q[e]);H=!1},d(t){t&&l(n),t&&l(i),t&&l(u),t&&l(x),t&&l(w),L(Q,t),t&&l(I),t&&l(T),L(X,t),M=!1,S(R)}}}function pt(t,e,n){let o,a;q(t,ct,(t=>n(2,o=t))),q(t,J,(t=>n(3,a=t)));let{book:s}=e,r=G.Text;return t.$$set=t=>{"book"in t&&n(0,s=t.book)},[s,r,o,a,function(){Q(s.id,r)},function(){r=A(this),n(1,r)}]}"object"==typeof window&&async function(){const{Peer:t}=await F((()=>import("../../chunks/index-ba983fd8.js").then((function(t){return t.i}))),["/_app/chunks/index-ba983fd8.js","/_app/chunks/vendor-60c255d9.js"]),e=new t(new window.Peer(`com-books-aicacia-${await R()}`));lt.set(e),it.forEach((t=>t(e))),it.length=0}();class bt extends e{constructor(t){super(),n(this,t,pt,mt,o,{book:0})}}function vt(t){let e,n;return{c(){e=a("div"),n=a("span"),this.h()},l(t){e=s(t,"DIV",{class:!0});var o=r(e);n=s(o,"SPAN",{class:!0,role:!0,"aria-hidden":!0}),r(n).forEach(l),o.forEach(l),this.h()},h(){f(n,"class","spinner-border spinner-border-sm"),f(n,"role","status"),f(n,"aria-hidden","true"),f(e,"class","d-flex align-items-center justify-content-center")},m(t,o){c(t,e,o),$(e,n)},p:i,i:i,o:i,d(t){t&&l(e)}}}function gt(t){let e,n;return e=new bt({props:{book:t[0]}}),{c(){w(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,o){T(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.book=t[0]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){_(e,t)}}}function $t(t){var e;let n,o,a,s,r,i;document.title=n="Book: "+(null==(e=t[0])?void 0:e.name);const u=[gt,vt],d=[];function f(t,e){return t[0]?0:1}return a=f(t),s=d[a]=u[a](t),{c(){o=E(),s.c(),r=x()},l(t){H('[data-svelte="svelte-1ansdeq"]',document.head).forEach(l),o=y(t),s.l(t),r=x()},m(t,e){c(t,o,e),d[a].m(t,e),c(t,r,e),i=!0},p(t,[e]){var o;(!i||1&e)&&n!==(n="Book: "+(null==(o=t[0])?void 0:o.name))&&(document.title=n);let l=a;a=f(t),a===l?d[a].p(t,e):(h(),m(d[l],1,1,(()=>{d[l]=null})),p(),s=d[a],s?s.p(t,e):(s=d[a]=u[a](t),s.c()),b(s,1),s.m(r.parentNode,r))},i(t){i||(b(s),i=!0)},o(t){m(s),i=!1},d(t){t&&l(o),d[a].d(t),t&&l(r)}}}async function kt({page:{params:t}}){return{props:{bookId:t.bookId}}}function xt(t,e,n){let o,a;q(t,z,(t=>n(2,a=t)));let{bookId:s}=e;return t.$$set=t=>{"bookId"in t&&n(1,s=t.bookId)},t.$$.update=()=>{6&t.$$.dirty&&n(0,o=a.table.rows.find((t=>t.id===s)))},[o,s,a]}export default class extends e{constructor(t){super(),n(this,t,xt,$t,o,{bookId:1})}}export{kt as load};
