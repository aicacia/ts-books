import{O as t,S as e,i as n,s as o,e as a,c as r,a as s,d as l,f as c,G as i,z as u,T as d,b as f,B as h,r as m,u as p,v as b,t as v,g,E as $,U as k,l as x,j as w,k as E,m as I,n as y,o as T,w as _,V,J as j,W as D,C,P,X as B,Y as O,h as L,K as N,L as S,M as q,Z as A,H}from"../../chunks/vendor-1b736329.js";import{p as M,g as R,b as U}from"../../chunks/books-d26deded.js";import{_ as z}from"../../chunks/preload-helper-9f12a5fd.js";var F;(F||(F={})).Text="text";const G=M("blocks",{table:new t.Table});function J(e,n){let o;return G.change((({table:a})=>{const r={bookId:e,type:n};var s;null!==(s=r)&&"object"==typeof s&&s.type===F.Text&&(r.text=new t.Text),o=a.add(r)})),o}function K(t){let e;return{c(){e=a("div")},l(t){e=r(t,"DIV",{}),s(e).forEach(l)},m(n,o){c(n,e,o),t[5](e)},p:i,i:i,o:i,d(n){n&&l(e),t[5](null)}}}function W(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(a,r){function s(t){try{c(o.next(t))}catch(e){r(e)}}function l(t){try{c(o.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,l)}c((o=o.apply(t,e||[])).next())}))};let a,r,s,{text:l}=e,{onTextChange:c}=e;return u((()=>o(void 0,void 0,void 0,(function*(){const{default:t}=yield z((()=>import("../../chunks/quill-465b6700.js").then((function(t){return t.q}))),["/_app/chunks/quill-465b6700.js","/_app/chunks/vendor-1b736329.js"]);n(4,r=new t(s,{modules:{toolbar:!1},theme:"snow"})),l&&r.setText(l),r.on("text-change",(function(t,e,n){"user"===n&&c(t)})),s.addEventListener("keydown",(function(t){if("Backspace"===t.key){const e=r.getText();""!==e&&"\n"!==e&&t.stopPropagation()}}),{capture:!0})})))),t.$$set=t=>{"text"in t&&n(1,l=t.text),"onTextChange"in t&&n(2,c=t.onTextChange)},t.$$.update=()=>{26&t.$$.dirty&&l!==a&&r&&(n(3,a=l),r.setText(l))},[s,l,c,a,r,function(t){d[t?"unshift":"push"]((()=>{s=t,n(0,s)}))}]}class X extends e{constructor(t){super(),n(this,t,W,K,o,{text:1,onTextChange:2})}}function Y(t){let e,n,o;return{c(){e=a("div"),n=a("h1"),o=v("Click to Edit"),this.h()},l(t){e=r(t,"DIV",{class:!0});var a=s(e);n=r(a,"H1",{});var c=s(n);o=g(c,"Click to Edit"),c.forEach(l),a.forEach(l),this.h()},h(){f(e,"class","d-flex align-items-center justify-content-center")},m(t,a){c(t,e,a),$(e,n),$(n,o)},p:i,i:i,o:i,d(t){t&&l(e)}}}function Z(t){let e,n,o=k.markdown(t[2])+"";return{c(){n=x(),this.h()},l(t){n=x(),this.h()},h(){e=new V(n)},m(t,a){e.m(o,t,a),c(t,n,a)},p(t,n){4&n&&o!==(o=k.markdown(t[2])+"")&&e.p(o)},i:i,o:i,d(t){t&&l(n),t&&e.d()}}}function Q(t){let e,n,o,i,u,d,h=k.markdown(t[3])+"";return o=new X({props:{text:t[2],onTextChange:t[4]}}),{c(){e=a("div"),n=a("div"),w(o.$$.fragment),i=E(),u=a("div"),this.h()},l(t){e=r(t,"DIV",{class:!0});var a=s(e);n=r(a,"DIV",{class:!0});var c=s(n);I(o.$$.fragment,c),c.forEach(l),i=y(a),u=r(a,"DIV",{class:!0}),s(u).forEach(l),a.forEach(l),this.h()},h(){f(n,"class","col-6"),f(u,"class","col-6"),f(e,"class","row")},m(t,a){c(t,e,a),$(e,n),T(o,n,null),$(e,i),$(e,u),u.innerHTML=h,d=!0},p(t,e){const n={};4&e&&(n.text=t[2]),o.$set(n),(!d||8&e)&&h!==(h=k.markdown(t[3])+"")&&(u.innerHTML=h)},i(t){d||(b(o.$$.fragment,t),d=!0)},o(t){m(o.$$.fragment,t),d=!1},d(t){t&&l(e),_(o)}}}function tt(t){let e,n,o,i,u,d;const v=[Q,Z,Y],g=[];function $(t,e){return t[1]?0:(4&e&&(n=!!t[2].trim()),n?1:2)}return o=$(t,-1),i=g[o]=v[o](t),{c(){e=a("div"),i.c(),this.h()},l(t){e=r(t,"DIV",{id:!0});var n=s(e);i.l(n),n.forEach(l),this.h()},h(){f(e,"id",u=t[0].id)},m(t,n){c(t,e,n),g[o].m(e,null),d=!0},p(t,[n]){let a=o;o=$(t,n),o===a?g[o].p(t,n):(h(),m(g[a],1,1,(()=>{g[a]=null})),p(),i=g[o],i?i.p(t,n):(i=g[o]=v[o](t),i.c()),b(i,1),i.m(e,null)),(!d||1&n&&u!==(u=t[0].id))&&f(e,"id",u)},i(t){d||(b(i),d=!0)},o(t){m(i),d=!1},d(t){t&&l(e),g[o].d()}}}function et(t,e,n){let o,{block:a}=e,{edit:r}=e,s=a.text.toString(),l=s;return t.$$set=t=>{"block"in t&&n(0,a=t.block),"edit"in t&&n(1,r=t.edit)},t.$$.update=()=>{39&t.$$.dirty&&r!==o&&(n(5,o=r),n(2,s=a.text.toString()),n(3,l=s))},[a,r,s,l,function(t){var e,o;e=a.id,o=e=>{!function(t,e){let n=0;e.forEach(((e,o)=>{if(e.retain&&(n+=e.retain),"string"==typeof e.insert){const o=e.insert.split("");t.insertAt(n,...o),n+=o.length}else e.delete&&t.deleteAt(n,e.delete)}))}(e.text,t),n(3,l=e.text.toString())},G.change((({table:t})=>{const n=t.byId(e);n&&o(n)}))},o]}class nt extends e{constructor(t){super(),n(this,t,et,tt,o,{block:0,edit:1})}}function ot(t){let e,n;return e=new nt({props:{block:t[0],edit:t[1]}}),{c(){w(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,o){T(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.block=t[0]),2&n&&(o.edit=t[1]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){_(e,t)}}}function at(t){let e,n,o,i,u=t[0].type===F.Text&&ot(t);return{c(){e=a("div"),u&&u.c(),this.h()},l(t){e=r(t,"DIV",{class:!0});var n=s(e);u&&u.l(n),n.forEach(l),this.h()},h(){f(e,"class","mb-4")},m(a,r){c(a,e,r),u&&u.m(e,null),n=!0,o||(i=j(e,"click",D(t[2])),o=!0)},p(t,[n]){t[0].type===F.Text?u?(u.p(t,n),1&n&&b(u,1)):(u=ot(t),u.c(),b(u,1),u.m(e,null)):u&&(h(),m(u,1,1,(()=>{u=null})),p())},i(t){n||(b(u),n=!0)},o(t){m(u),n=!1},d(t){t&&l(e),u&&u.d(),o=!1,i()}}}function rt(t,e,n){let o,{block:a}=e;u((()=>{window.addEventListener("click",(()=>n(1,o=!1)))}));return t.$$set=t=>{"block"in t&&n(0,a=t.block)},[a,o,()=>n(1,o=!0)]}class st extends e{constructor(t){super(),n(this,t,rt,at,o,{block:0})}}const lt=C(null),ct={subscribe:lt.subscribe,get:()=>P(lt)},it=[];function ut(t,e,n){const o=t.slice();return o[6]=e[n][0],o[7]=e[n][1],o}function dt(t,e,n){const o=t.slice();return o[10]=e[n],o}function ft(t){let e,n;return e=new st({props:{block:t[10]}}),{c(){w(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,o){T(e,t,o),n=!0},p(t,n){const o={};8&n&&(o.block=t[10]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){_(e,t)}}}function ht(t){let e,n,o=t[6]+"";return{c(){e=a("option"),n=v(o),this.h()},l(t){e=r(t,"OPTION",{value:!0});var a=s(e);n=g(a,o),a.forEach(l),this.h()},h(){e.__value=t[7],e.value=e.__value},m(t,o){c(t,e,o),$(e,n)},p:i,d(t){t&&l(e)}}}function mt(t){var e;let n,o,i,u,d,k,x,w,I,T,_,V,D,C,P,q,A,H,M,R,U=t[0].name+"",z=(null==(e=t[2])?void 0:e.getId())+"",G=t[3].table.rows,J=[];for(let a=0;a<G.length;a+=1)J[a]=ft(dt(t,G,a));const K=t=>m(J[t],1,1,(()=>{J[t]=null}));let W=Object.entries(F),X=[];for(let a=0;a<W.length;a+=1)X[a]=ht(ut(t,W,a));return{c(){n=a("h1"),o=v(U),i=E(),u=a("p"),d=v("PeerId: "),k=v(z),x=E(),w=a("div");for(let t=0;t<J.length;t+=1)J[t].c();I=E(),T=a("div"),_=a("form"),V=a("div"),D=a("select");for(let t=0;t<X.length;t+=1)X[t].c();C=E(),P=a("div"),q=a("button"),A=v("Create Block"),this.h()},l(t){n=r(t,"H1",{});var e=s(n);o=g(e,U),e.forEach(l),i=y(t),u=r(t,"P",{});var a=s(u);d=g(a,"PeerId: "),k=g(a,z),a.forEach(l),x=y(t),w=r(t,"DIV",{class:!0});var c=s(w);for(let n=0;n<J.length;n+=1)J[n].l(c);c.forEach(l),I=y(t),T=r(t,"DIV",{class:!0});var f=s(T);_=r(f,"FORM",{action:!0,class:!0});var h=s(_);V=r(h,"DIV",{class:!0});var m=s(V);D=r(m,"SELECT",{class:!0,placeholder:!0,"aria-label":!0,required:!0});var p=s(D);for(let n=0;n<X.length;n+=1)X[n].l(p);p.forEach(l),m.forEach(l),C=y(h),P=r(h,"DIV",{class:!0});var b=s(P);q=r(b,"BUTTON",{type:!0,class:!0,"aria-label":!0});var v=s(q);A=g(v,"Create Block"),v.forEach(l),b.forEach(l),h.forEach(l),f.forEach(l),this.h()},h(){f(w,"class","mt-4"),f(D,"class","form-select"),f(D,"placeholder","New Book Name"),f(D,"aria-label","New Book Name"),D.required=!0,void 0===t[1]&&B((()=>t[5].call(D))),f(V,"class","col-auto"),f(q,"type","submit"),f(q,"class","form-control btn btn-primary"),f(q,"aria-label","Create Block"),f(P,"class","col-auto"),f(_,"action","javascript:void(0);"),f(_,"class","row mt-4"),f(T,"class","d-flex align-items-center justify-content-center")},m(e,a){c(e,n,a),$(n,o),c(e,i,a),c(e,u,a),$(u,d),$(u,k),c(e,x,a),c(e,w,a);for(let t=0;t<J.length;t+=1)J[t].m(w,null);c(e,I,a),c(e,T,a),$(T,_),$(_,V),$(V,D);for(let t=0;t<X.length;t+=1)X[t].m(D,null);O(D,t[1]),$(_,C),$(_,P),$(P,q),$(q,A),H=!0,M||(R=[j(D,"change",t[5]),j(q,"click",t[4])],M=!0)},p(t,[e]){var n;if((!H||1&e)&&U!==(U=t[0].name+"")&&L(o,U),(!H||4&e)&&z!==(z=(null==(n=t[2])?void 0:n.getId())+"")&&L(k,z),8&e){let n;for(G=t[3].table.rows,n=0;n<G.length;n+=1){const o=dt(t,G,n);J[n]?(J[n].p(o,e),b(J[n],1)):(J[n]=ft(o),J[n].c(),b(J[n],1),J[n].m(w,null))}for(h(),n=G.length;n<J.length;n+=1)K(n);p()}if(0&e){let n;for(W=Object.entries(F),n=0;n<W.length;n+=1){const o=ut(t,W,n);X[n]?X[n].p(o,e):(X[n]=ht(o),X[n].c(),X[n].m(D,null))}for(;n<X.length;n+=1)X[n].d(1);X.length=W.length}2&e&&O(D,t[1])},i(t){if(!H){for(let t=0;t<G.length;t+=1)b(J[t]);H=!0}},o(t){J=J.filter(Boolean);for(let e=0;e<J.length;e+=1)m(J[e]);H=!1},d(t){t&&l(n),t&&l(i),t&&l(u),t&&l(x),t&&l(w),N(J,t),t&&l(I),t&&l(T),N(X,t),M=!1,S(R)}}}function pt(t,e,n){let o,a;q(t,ct,(t=>n(2,o=t))),q(t,G,(t=>n(3,a=t)));let{book:r}=e,s=F.Text;return t.$$set=t=>{"book"in t&&n(0,r=t.book)},[r,s,o,a,function(){J(r.id,s)},function(){s=A(this),n(1,s)}]}"object"==typeof window&&async function(){const{Peer:t}=await z((()=>import("../../chunks/index-9c95b8fc.js").then((function(t){return t.i}))),["/_app/chunks/index-9c95b8fc.js","/_app/chunks/vendor-1b736329.js"]),e=new t(new window.Peer(`com-books-aicacia-${await R()}`));lt.set(e),it.forEach((t=>t(e))),it.length=0}();class bt extends e{constructor(t){super(),n(this,t,pt,mt,o,{book:0})}}function vt(t){let e,n;return{c(){e=a("div"),n=a("span"),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=s(e);n=r(o,"SPAN",{class:!0,role:!0,"aria-hidden":!0}),s(n).forEach(l),o.forEach(l),this.h()},h(){f(n,"class","spinner-border spinner-border-sm"),f(n,"role","status"),f(n,"aria-hidden","true"),f(e,"class","d-flex align-items-center justify-content-center")},m(t,o){c(t,e,o),$(e,n)},p:i,i:i,o:i,d(t){t&&l(e)}}}function gt(t){let e,n;return e=new bt({props:{book:t[0]}}),{c(){w(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,o){T(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.book=t[0]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){_(e,t)}}}function $t(t){var e;let n,o,a,r,s,i;document.title=n="Book: "+(null==(e=t[0])?void 0:e.name);const u=[gt,vt],d=[];function f(t,e){return t[0]?0:1}return a=f(t),r=d[a]=u[a](t),{c(){o=E(),r.c(),s=x()},l(t){H('[data-svelte="svelte-1ansdeq"]',document.head).forEach(l),o=y(t),r.l(t),s=x()},m(t,e){c(t,o,e),d[a].m(t,e),c(t,s,e),i=!0},p(t,[e]){var o;(!i||1&e)&&n!==(n="Book: "+(null==(o=t[0])?void 0:o.name))&&(document.title=n);let l=a;a=f(t),a===l?d[a].p(t,e):(h(),m(d[l],1,1,(()=>{d[l]=null})),p(),r=d[a],r?r.p(t,e):(r=d[a]=u[a](t),r.c()),b(r,1),r.m(s.parentNode,s))},i(t){i||(b(r),i=!0)},o(t){m(r),i=!1},d(t){t&&l(o),d[a].d(t),t&&l(s)}}}async function kt({page:{params:t}}){return{props:{bookId:t.bookId}}}function xt(t,e,n){let o,a;q(t,U,(t=>n(2,a=t)));let{bookId:r}=e;return t.$$set=t=>{"bookId"in t&&n(1,r=t.bookId)},t.$$.update=()=>{6&t.$$.dirty&&n(0,o=a.table.rows.find((t=>t.id===r)))},[o,r,a]}export default class extends e{constructor(t){super(),n(this,t,xt,$t,o,{bookId:1})}}export{kt as load};
