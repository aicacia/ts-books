import{S as t,i as e,s as n,e as o,c as r,a as s,d as a,f as l,G as c,V as i,z as u,W as d,X as f,b as h,y as m,B as $,r as p,u as g,v as k,Y as b,t as v,g as x,E as w,j as I,m as E,o as y,w as V,k as D,n as T,L as B,Z as S,h as _,I as j,K as L,M as O,N,O as C,_ as P,P as q,l as H,H as M}from"../../chunks/vendor-83b66aae.js";import{u as A,a as R,b as z,c as F}from"../../chunks/books-b78244e7.js";import{_ as G}from"../../chunks/preload-helper-9f12a5fd.js";function K(t){let e;return{c(){e=o("div")},l(t){e=r(t,"DIV",{}),s(e).forEach(a)},m(n,o){l(n,e,o),t[5](e)},p:c,i:c,o:c,d(n){n&&a(e),t[5](null)}}}function U(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,s){function a(t){try{c(o.next(t))}catch(e){s(e)}}function l(t){try{c(o.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}c((o=o.apply(t,e||[])).next())}))};let r,{text:s}=e,{multiline:a=!0}=e;const l=i();let c,f;return u((()=>o(void 0,void 0,void 0,(function*(){const{default:t}=yield G((()=>import("../../chunks/quill-bedaa037.js").then((function(t){return t.q}))),["/_app/chunks/quill-bedaa037.js","/_app/chunks/vendor-83b66aae.js"]);n(4,c=new t(f,{modules:{toolbar:!1},theme:"snow"})),s&&c.setText(s),c.on("text-change",(function(t,e,n){"user"===n&&l("textchange",t)})),f.addEventListener("keydown",(function(t){if("Backspace"===t.key){const e=c.getText();""!==e&&"\n"!==e&&t.stopPropagation()}}),{capture:!0})})))),t.$$set=t=>{"text"in t&&n(1,s=t.text),"multiline"in t&&n(2,a=t.multiline)},t.$$.update=()=>{26&t.$$.dirty&&s!==r&&c&&(n(3,r=s),c.setText(s))},[f,s,a,r,c,function(t){d[t?"unshift":"push"]((()=>{f=t,n(0,f)}))}]}class W extends t{constructor(t){super(),e(this,t,U,K,n,{text:1,multiline:2})}}function X(t){let e,n=f.parse(t[0])+"";return{c(){e=o("div"),this.h()},l(t){e=r(t,"DIV",{class:!0}),s(e).forEach(a),this.h()},h(){h(e,"class","markdown")},m(o,r){l(o,e,r),e.innerHTML=n,t[2](e)},p(t,[o]){1&o&&n!==(n=f.parse(t[0])+"")&&(e.innerHTML=n)},i:c,o:c,d(n){n&&a(e),t[2](null)}}}function Y(t,e,n){let o,r,{markdown:s}=e;const a={delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1};return m((()=>{r&&o!==s&&(o=s,window.renderMathInElement(r,a))})),t.$$set=t=>{"markdown"in t&&n(0,s=t.markdown)},[s,r,function(t){d[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class Z extends t{constructor(t){super(),e(this,t,Y,X,n,{markdown:0})}}function J(t,e){let n=0;for(const o of e)if(o.retain&&(n+=o.retain),"string"==typeof o.insert){const e=o.insert.split("");t.insertAt(n,...e),n+=e.length}else o.delete&&t.deleteAt(n,o.delete)}function Q(t){let e,n,i;return{c(){e=o("div"),n=o("h1"),i=v("Click to Edit"),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=s(e);n=r(o,"H1",{});var l=s(n);i=x(l,"Click to Edit"),l.forEach(a),o.forEach(a),this.h()},h(){h(e,"class","d-flex align-items-center justify-content-center")},m(t,o){l(t,e,o),w(e,n),w(n,i)},p:c,i:c,o:c,d(t){t&&a(e)}}}function tt(t){let e,n;return e=new Z({props:{markdown:t[1].text.toString()}}),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.markdown=t[1].text.toString()),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){V(e,t)}}}function et(t){let e,n,c,i,u,d,f;return c=new W({props:{text:t[2]}}),c.$on("textchange",t[4]),d=new Z({props:{markdown:t[3]}}),{c(){e=o("div"),n=o("div"),I(c.$$.fragment),i=D(),u=o("div"),I(d.$$.fragment),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=s(e);n=r(o,"DIV",{class:!0});var l=s(n);E(c.$$.fragment,l),l.forEach(a),i=T(o),u=r(o,"DIV",{class:!0});var f=s(u);E(d.$$.fragment,f),f.forEach(a),o.forEach(a),this.h()},h(){h(n,"class","col-6"),h(u,"class","col-6"),h(e,"class","row")},m(t,o){l(t,e,o),w(e,n),y(c,n,null),w(e,i),w(e,u),y(d,u,null),f=!0},p(t,e){const n={};4&e&&(n.text=t[2]),c.$set(n);const o={};8&e&&(o.markdown=t[3]),d.$set(o)},i(t){f||(k(c.$$.fragment,t),k(d.$$.fragment,t),f=!0)},o(t){p(c.$$.fragment,t),p(d.$$.fragment,t),f=!1},d(t){t&&a(e),V(c),V(d)}}}function nt(t){let e,n,c,i,u;const d=[et,tt,Q],f=[];function h(t,e){return t[0]?0:(2&e&&(n=!!t[1].text.toString().trim()),n?1:2)}return c=h(t,-1),i=f[c]=d[c](t),{c(){e=o("div"),i.c()},l(t){e=r(t,"DIV",{});var n=s(e);i.l(n),n.forEach(a)},m(t,n){l(t,e,n),f[c].m(e,null),u=!0},p(t,[n]){let o=c;c=h(t,n),c===o?f[c].p(t,n):($(),p(f[o],1,1,(()=>{f[o]=null})),g(),i=f[c],i?i.p(t,n):(i=f[c]=d[c](t),i.c()),k(i,1),i.m(e,null))},i(t){u||(k(i),u=!0)},o(t){p(i),u=!1},d(t){t&&a(e),f[c].d()}}}function ot(t,e,n){let o,{bookId:r}=e,{block:s}=e,{edit:a}=e,l=s.text.toString(),c=l;return b((()=>{a!==o&&(o=a,n(2,l=s.text.toString()),n(3,c=l))})),u((()=>{window.addEventListener("click",(()=>n(0,a=!1)))})),t.$$set=t=>{"bookId"in t&&n(5,r=t.bookId),"block"in t&&n(1,s=t.block),"edit"in t&&n(0,a=t.edit)},[a,s,l,c,function(t){A(r,s.id,(e=>{J(e.text,t.detail.ops),n(3,c=e.text.toString())}))},r]}class rt extends t{constructor(t){super(),e(this,t,ot,nt,n,{bookId:5,block:1,edit:0})}}function st(t){let e,n;return e=new rt({props:{bookId:t[0],block:t[1],edit:t[2]}}),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.bookId=t[0]),2&n&&(o.block=t[1]),4&n&&(o.edit=t[2]),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){V(e,t)}}}function at(t){let e,n,c,i,u=t[1].type===R.Text&&st(t);return{c(){e=o("div"),u&&u.c(),this.h()},l(t){e=r(t,"DIV",{class:!0});var n=s(e);u&&u.l(n),n.forEach(a),this.h()},h(){h(e,"class","mb-4")},m(o,r){l(o,e,r),u&&u.m(e,null),n=!0,c||(i=B(e,"click",S(t[3])),c=!0)},p(t,[n]){t[1].type===R.Text?u?(u.p(t,n),2&n&&k(u,1)):(u=st(t),u.c(),k(u,1),u.m(e,null)):u&&($(),p(u,1,1,(()=>{u=null})),g())},i(t){n||(k(u),n=!0)},o(t){p(u),n=!1},d(t){t&&a(e),u&&u.d(),c=!1,i()}}}function lt(t,e,n){let o,{bookId:r}=e,{block:s}=e;u((()=>{window.addEventListener("click",(()=>n(2,o=!1)))}));return t.$$set=t=>{"bookId"in t&&n(0,r=t.bookId),"block"in t&&n(1,s=t.block)},[r,s,o,()=>n(2,o=!0)]}class ct extends t{constructor(t){super(),e(this,t,lt,at,n,{bookId:0,block:1})}}function it(t){let e,n=t[0].toString()+"";return{c(){e=v(n)},l(t){e=x(t,n)},m(t,n){l(t,e,n)},p(t,o){1&o&&n!==(n=t[0].toString()+"")&&_(e,n)},i:c,o:c,d(t){t&&a(e)}}}function ut(t){let e,n;return e=new W({props:{text:t[1],multiline:!1}}),e.$on("textchange",t[3]),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.text=t[1]),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){V(e,t)}}}function dt(t){let e,n,c,i,u,d;const f=[ut,it],h=[];function m(t,e){return t[2]?0:1}return n=m(t),c=h[n]=f[n](t),{c(){e=o("div"),c.c()},l(t){e=r(t,"DIV",{});var n=s(e);c.l(n),n.forEach(a)},m(o,r){l(o,e,r),h[n].m(e,null),i=!0,u||(d=B(e,"click",S(t[4])),u=!0)},p(t,[o]){let r=n;n=m(t),n===r?h[n].p(t,o):($(),p(h[r],1,1,(()=>{h[r]=null})),g(),c=h[n],c?c.p(t,o):(c=h[n]=f[n](t),c.c()),k(c,1),c.m(e,null))},i(t){i||(k(c),i=!0)},o(t){p(c),i=!1},d(t){t&&a(e),h[n].d(),u=!1,d()}}}function ft(t,e,n){let{text:o}=e;const r=i();let s,a,l=o.toString();b((()=>{s!==a&&(a=s,n(1,l=o.toString()))})),u((()=>{window.addEventListener("click",(()=>n(2,s=!1)))}));return t.$$set=t=>{"text"in t&&n(0,o=t.text)},[o,l,s,function(t){r("textchange",t.detail)},()=>n(2,s=!0)]}class ht extends t{constructor(t){super(),e(this,t,ft,dt,n,{text:0})}}function mt(t,e,n){const o=t.slice();return o[7]=e[n][0],o[8]=e[n][1],o}function $t(t,e,n){const o=t.slice();return o[11]=e[n],o}function pt(t){let e,n;return e=new ct({props:{bookId:t[0].id,block:t[11]}}),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.bookId=t[0].id),4&n&&(o.block=t[11]),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){V(e,t)}}}function gt(t){let e,n,i=t[7]+"";return{c(){e=o("option"),n=v(i),this.h()},l(t){e=r(t,"OPTION",{value:!0});var o=s(e);n=x(o,i),o.forEach(a),this.h()},h(){e.__value=t[8],e.value=e.__value},m(t,o){l(t,e,o),w(e,n)},p:c,d(t){t&&a(e)}}}function kt(t){let e,n,c,i,u,d,f,m,b,S,_,C,P,q,H,M;n=new ht({props:{text:t[0].name}}),n.$on("textchange",t[5]);let A=t[2].blocks.rows,z=[];for(let o=0;o<A.length;o+=1)z[o]=pt($t(t,A,o));const F=t=>p(z[t],1,1,(()=>{z[t]=null}));let G=Object.entries(R),K=[];for(let o=0;o<G.length;o+=1)K[o]=gt(mt(t,G,o));return{c(){e=o("h1"),I(n.$$.fragment),c=D(),i=o("div");for(let t=0;t<z.length;t+=1)z[t].c();u=D(),d=o("div"),f=o("form"),m=o("div"),b=o("select");for(let t=0;t<K.length;t+=1)K[t].c();S=D(),_=o("div"),C=o("button"),P=v("Create"),this.h()},l(t){e=r(t,"H1",{});var o=s(e);E(n.$$.fragment,o),o.forEach(a),c=T(t),i=r(t,"DIV",{class:!0});var l=s(i);for(let e=0;e<z.length;e+=1)z[e].l(l);l.forEach(a),u=T(t),d=r(t,"DIV",{class:!0});var h=s(d);f=r(h,"FORM",{action:!0,class:!0});var $=s(f);m=r($,"DIV",{class:!0});var p=s(m);b=r(p,"SELECT",{class:!0,placeholder:!0,"aria-label":!0,required:!0});var g=s(b);for(let e=0;e<K.length;e+=1)K[e].l(g);g.forEach(a),p.forEach(a),S=T($),_=r($,"DIV",{class:!0});var k=s(_);C=r(k,"BUTTON",{type:!0,class:!0,"aria-label":!0});var v=s(C);P=x(v,"Create"),v.forEach(a),k.forEach(a),$.forEach(a),h.forEach(a),this.h()},h(){h(i,"class","mt-4"),h(b,"class","form-select"),h(b,"placeholder","New Block Type"),h(b,"aria-label","New Block Type"),b.required=!0,void 0===t[1]&&j((()=>t[6].call(b))),h(m,"class","col-auto"),h(C,"type","submit"),h(C,"class","btn btn-primary"),h(C,"aria-label","Create Block"),h(_,"class","col-auto"),h(f,"action","javascript:void(0);"),h(f,"class","row mt-4"),h(d,"class","d-flex align-items-center justify-content-center")},m(o,r){l(o,e,r),y(n,e,null),l(o,c,r),l(o,i,r);for(let t=0;t<z.length;t+=1)z[t].m(i,null);l(o,u,r),l(o,d,r),w(d,f),w(f,m),w(m,b);for(let t=0;t<K.length;t+=1)K[t].m(b,null);L(b,t[1]),w(f,S),w(f,_),w(_,C),w(C,P),q=!0,H||(M=[B(b,"change",t[6]),B(C,"click",t[4])],H=!0)},p(t,[e]){const o={};if(1&e&&(o.text=t[0].name),n.$set(o),5&e){let n;for(A=t[2].blocks.rows,n=0;n<A.length;n+=1){const o=$t(t,A,n);z[n]?(z[n].p(o,e),k(z[n],1)):(z[n]=pt(o),z[n].c(),k(z[n],1),z[n].m(i,null))}for($(),n=A.length;n<z.length;n+=1)F(n);g()}if(0&e){let n;for(G=Object.entries(R),n=0;n<G.length;n+=1){const o=mt(t,G,n);K[n]?K[n].p(o,e):(K[n]=gt(o),K[n].c(),K[n].m(b,null))}for(;n<K.length;n+=1)K[n].d(1);K.length=G.length}2&e&&L(b,t[1])},i(t){if(!q){k(n.$$.fragment,t);for(let t=0;t<A.length;t+=1)k(z[t]);q=!0}},o(t){p(n.$$.fragment,t),z=z.filter(Boolean);for(let e=0;e<z.length;e+=1)p(z[e]);q=!1},d(t){t&&a(e),V(n),t&&a(c),t&&a(i),O(z,t),t&&a(u),t&&a(d),O(K,t),H=!1,N(M)}}}function bt(t,e,n){let o,{book:r}=e,s=R.Text,a=z.getBookById(r.id);return C(t,a,(t=>n(2,o=t))),P((()=>{z.unloadBookById(r.id)})),t.$$set=t=>{"book"in t&&n(0,r=t.book)},[r,s,o,a,function(){F(r.id,s)},function(t){z.change((e=>{J(e.metas.byId(r.id).name,t.detail.ops)}))},function(){s=q(this),n(1,s)}]}class vt extends t{constructor(t){super(),e(this,t,bt,kt,n,{book:0})}}function xt(t){let e,n;return{c(){e=o("div"),n=o("span"),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=s(e);n=r(o,"SPAN",{class:!0,role:!0,"aria-hidden":!0}),s(n).forEach(a),o.forEach(a),this.h()},h(){h(n,"class","spinner-border spinner-border-sm"),h(n,"role","status"),h(n,"aria-hidden","true"),h(e,"class","d-flex align-items-center justify-content-center")},m(t,o){l(t,e,o),w(e,n)},p:c,i:c,o:c,d(t){t&&a(e)}}}function wt(t){let e,n;return e=new vt({props:{book:t[0]}}),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.book=t[0]),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){V(e,t)}}}function It(t){var e;let n,o,r,s,c,i;document.title=n="Book: "+(null==(e=t[0])?void 0:e.name);const u=[wt,xt],d=[];function f(t,e){return t[0]?0:1}return r=f(t),s=d[r]=u[r](t),{c(){o=D(),s.c(),c=H()},l(t){M('[data-svelte="svelte-1ansdeq"]',document.head).forEach(a),o=T(t),s.l(t),c=H()},m(t,e){l(t,o,e),d[r].m(t,e),l(t,c,e),i=!0},p(t,[e]){var o;(!i||1&e)&&n!==(n="Book: "+(null==(o=t[0])?void 0:o.name))&&(document.title=n);let a=r;r=f(t),r===a?d[r].p(t,e):($(),p(d[a],1,1,(()=>{d[a]=null})),g(),s=d[r],s?s.p(t,e):(s=d[r]=u[r](t),s.c()),k(s,1),s.m(c.parentNode,c))},i(t){i||(k(s),i=!0)},o(t){p(s),i=!1},d(t){t&&a(o),d[r].d(t),t&&a(c)}}}async function Et({page:{params:t}}){return{props:{bookId:t.bookId}}}function yt(t,e,n){let o,r;C(t,z,(t=>n(2,r=t)));let{bookId:s}=e;return t.$$set=t=>{"bookId"in t&&n(1,s=t.bookId)},t.$$.update=()=>{6&t.$$.dirty&&n(0,o=r.metas.byId(s))},[o,s,r]}export default class extends t{constructor(t){super(),e(this,t,yt,It,n,{bookId:1})}}export{Et as load};
