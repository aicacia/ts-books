import{S as t,i as e,s as n,e as o,c as r,a,d as s,f as l,G as c,V as i,z as u,W as d,X as f,b as h,y as m,B as $,r as p,u as g,v as k,Y as v,t as b,g as w,E as x,j as I,m as E,o as y,w as D,k as V,n as T,L as _,Z as S,h as B,I as j,K as L,M as O,N,O as P,_ as A,P as C,l as q,H}from"../../chunks/vendor-83b66aae.js";import{u as M,a as R,b as z,c as F}from"../../chunks/books-b70cc085.js";import{_ as G}from"../../chunks/preload-helper-9f12a5fd.js";function K(t){let e;return{c(){e=o("div")},l(t){e=r(t,"DIV",{}),a(e).forEach(s)},m(n,o){l(n,e,o),t[5](e)},p:c,i:c,o:c,d(n){n&&s(e),t[5](null)}}}function U(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,a){function s(t){try{c(o.next(t))}catch(e){a(e)}}function l(t){try{c(o.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,l)}c((o=o.apply(t,e||[])).next())}))};let r,{text:a}=e,{multiline:s=!0}=e;const l=i();let c,f;return u((()=>o(void 0,void 0,void 0,(function*(){const{default:t}=yield G((()=>import("../../chunks/quill-bedaa037.js").then((function(t){return t.q}))),["/_app/chunks/quill-bedaa037.js","/_app/chunks/vendor-83b66aae.js"]);n(4,c=new t(f,{modules:{toolbar:!1},theme:"snow"})),a&&c.setText(a),c.on("text-change",(function(t,e,n){"user"===n&&l("textchange",t)})),f.addEventListener("keydown",(function(t){if("Backspace"===t.key){const e=c.getText();""!==e&&"\n"!==e&&t.stopPropagation()}}),{capture:!0})})))),t.$$set=t=>{"text"in t&&n(1,a=t.text),"multiline"in t&&n(2,s=t.multiline)},t.$$.update=()=>{26&t.$$.dirty&&a!==r&&c&&(n(3,r=a),c.setText(a))},[f,a,s,r,c,function(t){d[t?"unshift":"push"]((()=>{f=t,n(0,f)}))}]}class W extends t{constructor(t){super(),e(this,t,U,K,n,{text:1,multiline:2})}}function X(t){let e,n=f.parse(t[0])+"";return{c(){e=o("div"),this.h()},l(t){e=r(t,"DIV",{class:!0}),a(e).forEach(s),this.h()},h(){h(e,"class","markdown")},m(o,r){l(o,e,r),e.innerHTML=n,t[2](e)},p(t,[o]){1&o&&n!==(n=f.parse(t[0])+"")&&(e.innerHTML=n)},i:c,o:c,d(n){n&&s(e),t[2](null)}}}function Y(t,e,n){let o,r,{markdown:a}=e;const s={delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1};return m((()=>{r&&o!==a&&(o=a,window.renderMathInElement(r,s))})),t.$$set=t=>{"markdown"in t&&n(0,a=t.markdown)},[a,r,function(t){d[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class Z extends t{constructor(t){super(),e(this,t,Y,X,n,{markdown:0})}}function J(t,e){let n=0;for(const o of e)if(o.retain&&(n+=o.retain),"string"==typeof o.insert){const e=o.insert.split("");t.insertAt(n,...e),n+=e.length}else o.delete&&t.deleteAt(n,o.delete)}function Q(t){let e,n,i;return{c(){e=o("div"),n=o("h1"),i=b("Click to Edit"),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=a(e);n=r(o,"H1",{});var l=a(n);i=w(l,"Click to Edit"),l.forEach(s),o.forEach(s),this.h()},h(){h(e,"class","d-flex align-items-center justify-content-center")},m(t,o){l(t,e,o),x(e,n),x(n,i)},p:c,i:c,o:c,d(t){t&&s(e)}}}function tt(t){let e,n;return e=new Z({props:{markdown:t[1].toString()}}),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.markdown=t[1].toString()),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function et(t){let e,n,c,i,u,d,f;return c=new W({props:{text:t[1]}}),c.$on("textchange",t[3]),d=new Z({props:{markdown:t[2]}}),{c(){e=o("div"),n=o("div"),I(c.$$.fragment),i=V(),u=o("div"),I(d.$$.fragment),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=a(e);n=r(o,"DIV",{class:!0});var l=a(n);E(c.$$.fragment,l),l.forEach(s),i=T(o),u=r(o,"DIV",{class:!0});var f=a(u);E(d.$$.fragment,f),f.forEach(s),o.forEach(s),this.h()},h(){h(n,"class","col-6"),h(u,"class","col-6"),h(e,"class","row")},m(t,o){l(t,e,o),x(e,n),y(c,n,null),x(e,i),x(e,u),y(d,u,null),f=!0},p(t,e){const n={};2&e&&(n.text=t[1]),c.$set(n);const o={};4&e&&(o.markdown=t[2]),d.$set(o)},i(t){f||(k(c.$$.fragment,t),k(d.$$.fragment,t),f=!0)},o(t){p(c.$$.fragment,t),p(d.$$.fragment,t),f=!1},d(t){t&&s(e),D(c),D(d)}}}function nt(t){let e,n,c,i,u;const d=[et,tt,Q],f=[];function h(t,e){return t[0]?0:(2&e&&(n=!!t[1].trim()),n?1:2)}return c=h(t,-1),i=f[c]=d[c](t),{c(){e=o("div"),i.c()},l(t){e=r(t,"DIV",{});var n=a(e);i.l(n),n.forEach(s)},m(t,n){l(t,e,n),f[c].m(e,null),u=!0},p(t,[n]){let o=c;c=h(t,n),c===o?f[c].p(t,n):($(),p(f[o],1,1,(()=>{f[o]=null})),g(),i=f[c],i?i.p(t,n):(i=f[c]=d[c](t),i.c()),k(i,1),i.m(e,null))},i(t){u||(k(i),u=!0)},o(t){p(i),u=!1},d(t){t&&s(e),f[c].d()}}}function ot(t,e,n){let o,{bookId:r}=e,{block:a}=e,{edit:s}=e,l=a.text.toString(),c=l;return v((()=>{s!==o&&(o=s,n(1,l=a.text.toString()),n(2,c=l))})),u((()=>{window.addEventListener("click",(()=>n(0,s=!1)))})),t.$$set=t=>{"bookId"in t&&n(4,r=t.bookId),"block"in t&&n(5,a=t.block),"edit"in t&&n(0,s=t.edit)},[s,l,c,function(t){M(r,a.id,(e=>{J(e.text,t.detail.ops),n(2,c=e.text.toString())}))},r,a]}class rt extends t{constructor(t){super(),e(this,t,ot,nt,n,{bookId:4,block:5,edit:0})}}function at(t){let e,n;return e=new rt({props:{bookId:t[0],block:t[1],edit:t[2]}}),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.bookId=t[0]),2&n&&(o.block=t[1]),4&n&&(o.edit=t[2]),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function st(t){let e,n,c,i,u,d,f,m=new Date(t[1].createdAt).toDateString()+"",v=t[1].type===R.Text&&at(t);return{c(){e=o("div"),n=o("div"),c=b(m),i=V(),v&&v.c(),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=a(e);n=r(o,"DIV",{});var l=a(n);c=w(l,m),l.forEach(s),i=T(o),v&&v.l(o),o.forEach(s),this.h()},h(){h(e,"class","mb-4")},m(o,r){l(o,e,r),x(e,n),x(n,c),x(e,i),v&&v.m(e,null),u=!0,d||(f=_(e,"click",S(t[3])),d=!0)},p(t,[n]){(!u||2&n)&&m!==(m=new Date(t[1].createdAt).toDateString()+"")&&B(c,m),t[1].type===R.Text?v?(v.p(t,n),2&n&&k(v,1)):(v=at(t),v.c(),k(v,1),v.m(e,null)):v&&($(),p(v,1,1,(()=>{v=null})),g())},i(t){u||(k(v),u=!0)},o(t){p(v),u=!1},d(t){t&&s(e),v&&v.d(),d=!1,f()}}}function lt(t,e,n){let o,{bookId:r}=e,{block:a}=e;u((()=>{window.addEventListener("click",(()=>n(2,o=!1)))}));return t.$$set=t=>{"bookId"in t&&n(0,r=t.bookId),"block"in t&&n(1,a=t.block)},[r,a,o,()=>n(2,o=!0)]}class ct extends t{constructor(t){super(),e(this,t,lt,st,n,{bookId:0,block:1})}}function it(t){let e,n=t[0].toString()+"";return{c(){e=b(n)},l(t){e=w(t,n)},m(t,n){l(t,e,n)},p(t,o){1&o&&n!==(n=t[0].toString()+"")&&B(e,n)},i:c,o:c,d(t){t&&s(e)}}}function ut(t){let e,n;return e=new W({props:{text:t[1],multiline:!1}}),e.$on("textchange",t[3]),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.text=t[1]),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function dt(t){let e,n,c,i,u,d;const f=[ut,it],h=[];function m(t,e){return t[2]?0:1}return n=m(t),c=h[n]=f[n](t),{c(){e=o("div"),c.c()},l(t){e=r(t,"DIV",{});var n=a(e);c.l(n),n.forEach(s)},m(o,r){l(o,e,r),h[n].m(e,null),i=!0,u||(d=_(e,"click",S(t[4])),u=!0)},p(t,[o]){let r=n;n=m(t),n===r?h[n].p(t,o):($(),p(h[r],1,1,(()=>{h[r]=null})),g(),c=h[n],c?c.p(t,o):(c=h[n]=f[n](t),c.c()),k(c,1),c.m(e,null))},i(t){i||(k(c),i=!0)},o(t){p(c),i=!1},d(t){t&&s(e),h[n].d(),u=!1,d()}}}function ft(t,e,n){let{text:o}=e;const r=i();let a,s,l=o.toString();v((()=>{a!==s&&(s=a,n(1,l=o.toString()))})),u((()=>{window.addEventListener("click",(()=>n(2,a=!1)))}));return t.$$set=t=>{"text"in t&&n(0,o=t.text)},[o,l,a,function(t){r("textchange",t.detail)},()=>n(2,a=!0)]}class ht extends t{constructor(t){super(),e(this,t,ft,dt,n,{text:0})}}function mt(t,e,n){const o=t.slice();return o[8]=e[n][0],o[9]=e[n][1],o}function $t(t,e,n){const o=t.slice();return o[12]=e[n],o}function pt(t){let e,n;return e=new ct({props:{bookId:t[0].id,block:t[12]}}),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.bookId=t[0].id),4&n&&(o.block=t[12]),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function gt(t){let e,n,i=t[8]+"";return{c(){e=o("option"),n=b(i),this.h()},l(t){e=r(t,"OPTION",{value:!0});var o=a(e);n=w(o,i),o.forEach(s),this.h()},h(){e.__value=t[9],e.value=e.__value},m(t,o){l(t,e,o),x(e,n)},p:c,d(t){t&&s(e)}}}function kt(t){let e,n,c,i,u,d,f,m,v,S,B,P,A,C,q,H;n=new ht({props:{text:t[0].name}}),n.$on("textchange",t[5]);let M=t[2].blocks.rows,z=[];for(let o=0;o<M.length;o+=1)z[o]=pt($t(t,M,o));const F=t=>p(z[t],1,1,(()=>{z[t]=null}));let G=Object.entries(R),K=[];for(let o=0;o<G.length;o+=1)K[o]=gt(mt(t,G,o));return{c(){e=o("h1"),I(n.$$.fragment),c=V(),i=o("div");for(let t=0;t<z.length;t+=1)z[t].c();u=V(),d=o("div"),f=o("form"),m=o("div"),v=o("select");for(let t=0;t<K.length;t+=1)K[t].c();S=V(),B=o("div"),P=o("button"),A=b("Create"),this.h()},l(t){e=r(t,"H1",{});var o=a(e);E(n.$$.fragment,o),o.forEach(s),c=T(t),i=r(t,"DIV",{class:!0});var l=a(i);for(let e=0;e<z.length;e+=1)z[e].l(l);l.forEach(s),u=T(t),d=r(t,"DIV",{class:!0});var h=a(d);f=r(h,"FORM",{action:!0,class:!0});var $=a(f);m=r($,"DIV",{class:!0});var p=a(m);v=r(p,"SELECT",{class:!0,placeholder:!0,"aria-label":!0,required:!0});var g=a(v);for(let e=0;e<K.length;e+=1)K[e].l(g);g.forEach(s),p.forEach(s),S=T($),B=r($,"DIV",{class:!0});var k=a(B);P=r(k,"BUTTON",{type:!0,class:!0,"aria-label":!0});var b=a(P);A=w(b,"Create"),b.forEach(s),k.forEach(s),$.forEach(s),h.forEach(s),this.h()},h(){h(i,"class","mt-4"),h(v,"class","form-select"),h(v,"placeholder","New Block Type"),h(v,"aria-label","New Block Type"),v.required=!0,void 0===t[1]&&j((()=>t[6].call(v))),h(m,"class","col-auto"),h(P,"type","submit"),h(P,"class","btn btn-primary"),h(P,"aria-label","Create Block"),h(B,"class","col-auto"),h(f,"action","javascript:void(0);"),h(f,"class","row mt-4"),h(d,"class","d-flex align-items-center justify-content-center")},m(o,r){l(o,e,r),y(n,e,null),l(o,c,r),l(o,i,r);for(let t=0;t<z.length;t+=1)z[t].m(i,null);l(o,u,r),l(o,d,r),x(d,f),x(f,m),x(m,v);for(let t=0;t<K.length;t+=1)K[t].m(v,null);L(v,t[1]),x(f,S),x(f,B),x(B,P),x(P,A),C=!0,q||(H=[_(v,"change",t[6]),_(P,"click",t[4])],q=!0)},p(t,[e]){const o={};if(1&e&&(o.text=t[0].name),n.$set(o),5&e){let n;for(M=t[2].blocks.rows,n=0;n<M.length;n+=1){const o=$t(t,M,n);z[n]?(z[n].p(o,e),k(z[n],1)):(z[n]=pt(o),z[n].c(),k(z[n],1),z[n].m(i,null))}for($(),n=M.length;n<z.length;n+=1)F(n);g()}if(0&e){let n;for(G=Object.entries(R),n=0;n<G.length;n+=1){const o=mt(t,G,n);K[n]?K[n].p(o,e):(K[n]=gt(o),K[n].c(),K[n].m(v,null))}for(;n<K.length;n+=1)K[n].d(1);K.length=G.length}2&e&&L(v,t[1])},i(t){if(!C){k(n.$$.fragment,t);for(let t=0;t<M.length;t+=1)k(z[t]);C=!0}},o(t){p(n.$$.fragment,t),z=z.filter(Boolean);for(let e=0;e<z.length;e+=1)p(z[e]);C=!1},d(t){t&&s(e),D(n),t&&s(c),t&&s(i),O(z,t),t&&s(u),t&&s(d),O(K,t),q=!1,N(H)}}}function vt(t,e,n){let o;var r=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,a){function s(t){try{c(o.next(t))}catch(e){a(e)}}function l(t){try{c(o.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,l)}c((o=o.apply(t,e||[])).next())}))};let{book:a}=e,s=R.Text,l=z.getBookById(a.id);return P(t,l,(t=>n(2,o=t))),A((()=>{z.unloadBookById(a.id)})),t.$$set=t=>{"book"in t&&n(0,a=t.book)},[a,s,o,l,function(){return r(this,void 0,void 0,(function*(){yield F(a.id,s)}))},function(t){z.change((e=>{J(e.metas.byId(a.id).name,t.detail.ops)}))},function(){s=C(this),n(1,s)}]}class bt extends t{constructor(t){super(),e(this,t,vt,kt,n,{book:0})}}function wt(t){let e,n;return{c(){e=o("div"),n=o("span"),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=a(e);n=r(o,"SPAN",{class:!0,role:!0,"aria-hidden":!0}),a(n).forEach(s),o.forEach(s),this.h()},h(){h(n,"class","spinner-border spinner-border-sm"),h(n,"role","status"),h(n,"aria-hidden","true"),h(e,"class","d-flex align-items-center justify-content-center")},m(t,o){l(t,e,o),x(e,n)},p:c,i:c,o:c,d(t){t&&s(e)}}}function xt(t){let e,n;return e=new bt({props:{book:t[0]}}),{c(){I(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){y(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.book=t[0]),e.$set(o)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){p(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function It(t){var e;let n,o,r,a,c,i;document.title=n="Book: "+(null==(e=t[0])?void 0:e.name);const u=[xt,wt],d=[];function f(t,e){return t[0]?0:1}return r=f(t),a=d[r]=u[r](t),{c(){o=V(),a.c(),c=q()},l(t){H('[data-svelte="svelte-1ansdeq"]',document.head).forEach(s),o=T(t),a.l(t),c=q()},m(t,e){l(t,o,e),d[r].m(t,e),l(t,c,e),i=!0},p(t,[e]){var o;(!i||1&e)&&n!==(n="Book: "+(null==(o=t[0])?void 0:o.name))&&(document.title=n);let s=r;r=f(t),r===s?d[r].p(t,e):($(),p(d[s],1,1,(()=>{d[s]=null})),g(),a=d[r],a?a.p(t,e):(a=d[r]=u[r](t),a.c()),k(a,1),a.m(c.parentNode,c))},i(t){i||(k(a),i=!0)},o(t){p(a),i=!1},d(t){t&&s(o),d[r].d(t),t&&s(c)}}}async function Et({page:{params:t}}){return{props:{bookId:t.bookId}}}function yt(t,e,n){let o,r;P(t,z,(t=>n(2,r=t)));let{bookId:a}=e;return t.$$set=t=>{"bookId"in t&&n(1,a=t.bookId)},t.$$.update=()=>{6&t.$$.dirty&&n(0,o=r.metas.byId(a))},[o,a,r]}export default class extends t{constructor(t){super(),e(this,t,yt,It,n,{bookId:1})}}export{Et as load};
