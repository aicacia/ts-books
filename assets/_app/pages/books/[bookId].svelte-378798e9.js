import{Q as t,S as e,i as n,s as o,e as a,c as r,a as s,d as c,f as i,I as l,z as u,V as d,b as f,B as h,r as m,u as p,v as b,t as g,g as v,G as k,D as $,l as x,j as w,k as y,m as E,n as I,o as _,w as T,W as D,L as V,X as j,Y as C,Z as P,h as O,M as B,N as L,O as M,_ as N,C as S,R,J as A,$ as Q}from"../../chunks/vendor-c9b40f2c.js";import{p as q,g as H,b as F,a as z,d as G}from"../../chunks/books-8edb3a0a.js";import{_ as J}from"../../chunks/preload-helper-9f12a5fd.js";var U;function W(t){return null!==t&&"object"==typeof t&&t.type===U.Text}function X(t){const e={id:t.id,bookId:t.bookId,type:t.type};if(W(t)){e.text=t.text.toString()}return e}(U||(U={})).Text="text";const Y=q("blocks",{table:new t.Table});function Z(t,e){Y.change((({table:n})=>{const o=n.byId(t);o&&e(o)}))}function K(t){let e;return{c(){e=a("div")},l(t){e=r(t,"DIV",{}),s(e).forEach(c)},m(n,o){i(n,e,o),t[6](e)},p:l,i:l,o:l,d(n){n&&c(e),t[6](null)}}}function tt(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(a,r){function s(t){try{i(o.next(t))}catch(e){r(e)}}function c(t){try{i(o.throw(t))}catch(e){r(e)}}function i(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}i((o=o.apply(t,e||[])).next())}))};let a,r,s,{text:c}=e,{onTextChange:i}=e,{onQuillMount:l}=e;return u((()=>o(void 0,void 0,void 0,(function*(){const{default:t}=yield J((()=>import("../../chunks/quill-23a75ab1.js").then((function(t){return t.q}))),["/_app/chunks/quill-23a75ab1.js","/_app/chunks/vendor-c9b40f2c.js"]);n(5,r=new t(s,{modules:{toolbar:!1},theme:"snow"})),c&&r.setText(c),r.on("text-change",(function(t,e,n){"user"===n&&i(t)})),s.addEventListener("keydown",(function(t){if("Backspace"===t.key){const e=r.getText();""!==e&&"\n"!==e&&t.stopPropagation()}}),{capture:!0}),l&&l(r)})))),t.$$set=t=>{"text"in t&&n(1,c=t.text),"onTextChange"in t&&n(2,i=t.onTextChange),"onQuillMount"in t&&n(3,l=t.onQuillMount)},t.$$.update=()=>{50&t.$$.dirty&&c!==a&&r&&(n(4,a=c),r.setText(c))},[s,c,i,l,a,r,function(t){d[t?"unshift":"push"]((()=>{s=t,n(0,s)}))}]}class et extends e{constructor(t){super(),n(this,t,tt,K,o,{text:1,onTextChange:2,onQuillMount:3})}}function nt(t){let e,n,o;return{c(){e=a("div"),n=a("h1"),o=g("Click to Edit"),this.h()},l(t){e=r(t,"DIV",{class:!0});var a=s(e);n=r(a,"H1",{});var i=s(n);o=v(i,"Click to Edit"),i.forEach(c),a.forEach(c),this.h()},h(){f(e,"class","d-flex align-items-center justify-content-center")},m(t,a){i(t,e,a),k(e,n),k(n,o)},p:l,i:l,o:l,d(t){t&&c(e)}}}function ot(t){let e,n,o=$.markdown(t[2])+"";return{c(){n=x(),this.h()},l(t){n=x(),this.h()},h(){e=new D(n)},m(t,a){e.m(o,t,a),i(t,n,a)},p(t,n){4&n&&o!==(o=$.markdown(t[2])+"")&&e.p(o)},i:l,o:l,d(t){t&&c(n),t&&e.d()}}}function at(t){let e,n,o,l,u,d,h=$.markdown(t[3])+"";return o=new et({props:{text:t[2],onTextChange:t[5],onQuillMount:t[4]}}),{c(){e=a("div"),n=a("div"),w(o.$$.fragment),l=y(),u=a("div"),this.h()},l(t){e=r(t,"DIV",{class:!0});var a=s(e);n=r(a,"DIV",{class:!0});var i=s(n);E(o.$$.fragment,i),i.forEach(c),l=I(a),u=r(a,"DIV",{class:!0}),s(u).forEach(c),a.forEach(c),this.h()},h(){f(n,"class","col-6"),f(u,"class","col-6"),f(e,"class","row")},m(t,a){i(t,e,a),k(e,n),_(o,n,null),k(e,l),k(e,u),u.innerHTML=h,d=!0},p(t,e){const n={};4&e&&(n.text=t[2]),o.$set(n),(!d||8&e)&&h!==(h=$.markdown(t[3])+"")&&(u.innerHTML=h)},i(t){d||(b(o.$$.fragment,t),d=!0)},o(t){m(o.$$.fragment,t),d=!1},d(t){t&&c(e),T(o)}}}function rt(t){let e,n,o,l,u,d;const g=[at,ot,nt],v=[];function k(t,e){return t[1]?0:(4&e&&(n=!!t[2].trim()),n?1:2)}return o=k(t,-1),l=v[o]=g[o](t),{c(){e=a("div"),l.c(),this.h()},l(t){e=r(t,"DIV",{id:!0});var n=s(e);l.l(n),n.forEach(c),this.h()},h(){f(e,"id",u=t[0].id)},m(t,n){i(t,e,n),v[o].m(e,null),d=!0},p(t,[n]){let a=o;o=k(t,n),o===a?v[o].p(t,n):(h(),m(v[a],1,1,(()=>{v[a]=null})),p(),l=v[o],l?l.p(t,n):(l=v[o]=g[o](t),l.c()),b(l,1),l.m(e,null)),(!d||1&n&&u!==(u=t[0].id))&&f(e,"id",u)},i(t){d||(b(l),d=!0)},o(t){m(l),d=!1},d(t){t&&c(e),v[o].d()}}}function st(t,e){let n=0;for(let o of e)if(o.retain&&(n+=o.retain),"string"==typeof o.insert){const e=o.insert.split("");t.insertAt(n,...e),n+=e.length}else o.delete&&t.deleteAt(n,o.delete)}function ct(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(a,r){function s(t){try{i(o.next(t))}catch(e){r(e)}}function c(t){try{i(o.throw(t))}catch(e){r(e)}}function i(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}i((o=o.apply(t,e||[])).next())}))};let a,r,s,{block:c}=e,{edit:i}=e,{room:l}=e,d=l,f=c.text.toString(),h=f;function m(t){"edit-text-block"===t.type&&t.payload.id===c.id&&Z(c.id,(e=>{st(e.text,t.payload.ops),i?(null==s||s.updateContents(new a(t.payload.ops),"api"),n(3,h=e.text.toString())):n(2,f=e.text.toString())}))}return u((()=>o(void 0,void 0,void 0,(function*(){const{default:t}=yield J((()=>import("../../chunks/Delta-2477219f.js").then((function(t){return t.D}))),["/_app/chunks/Delta-2477219f.js","/_app/chunks/vendor-c9b40f2c.js"]);a=t})))),t.$$set=t=>{"block"in t&&n(0,c=t.block),"edit"in t&&n(1,i=t.edit),"room"in t&&n(6,l=t.room)},t.$$.update=()=>{263&t.$$.dirty&&i!==r&&(n(8,r=i),n(2,f=c.text.toString()),n(3,h=f)),192&t.$$.dirty&&d!==l&&(null==d||d.off("message",m),null==l||l.on("message",m),n(7,d=l))},[c,i,f,h,function(t){s=t},function(t){Z(c.id,(e=>{null==l||l.broadcast("edit-text-block",{id:e.id,ops:t.ops}),st(e.text,t.ops),n(3,h=e.text.toString())}))},l,d,r]}class it extends e{constructor(t){super(),n(this,t,ct,rt,o,{block:0,edit:1,room:6})}}function lt(t){let e,n;return e=new it({props:{block:t[0],edit:t[1]}}),{c(){w(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){_(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.block=t[0]),2&n&&(o.edit=t[1]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}function ut(t){let e,n,o,l,u=t[0].type===U.Text&&lt(t);return{c(){e=a("div"),u&&u.c(),this.h()},l(t){e=r(t,"DIV",{class:!0});var n=s(e);u&&u.l(n),n.forEach(c),this.h()},h(){f(e,"class","mb-4")},m(a,r){i(a,e,r),u&&u.m(e,null),n=!0,o||(l=V(e,"click",j(t[2])),o=!0)},p(t,[n]){t[0].type===U.Text?u?(u.p(t,n),1&n&&b(u,1)):(u=lt(t),u.c(),b(u,1),u.m(e,null)):u&&(h(),m(u,1,1,(()=>{u=null})),p())},i(t){n||(b(u),n=!0)},o(t){m(u),n=!1},d(t){t&&c(e),u&&u.d(),o=!1,l()}}}function dt(t,e,n){let o,{block:a}=e;u((()=>{window.addEventListener("click",(()=>n(1,o=!1)))}));return t.$$set=t=>{"block"in t&&n(0,a=t.block)},[a,o,()=>n(1,o=!0)]}class ft extends e{constructor(t){super(),n(this,t,dt,ut,o,{block:0})}}function ht(t,e,n){const o=t.slice();return o[6]=e[n][0],o[7]=e[n][1],o}function mt(t,e,n){const o=t.slice();return o[10]=e[n],o}function pt(t){let e,n;return e=new ft({props:{block:t[10],room:t[1]}}),{c(){w(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){_(e,t,o),n=!0},p(t,n){const o={};8&n&&(o.block=t[10]),2&n&&(o.room=t[1]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}function bt(t){let e,n,o=t[6]+"";return{c(){e=a("option"),n=g(o),this.h()},l(t){e=r(t,"OPTION",{value:!0});var a=s(e);n=v(a,o),a.forEach(c),this.h()},h(){e.__value=t[7],e.value=e.__value},m(t,o){i(t,e,o),k(e,n)},p:l,d(t){t&&c(e)}}}function gt(t){let e,n,o,l,u,d,$,x,w,E,_,T,D,j,M,N,S=t[0].name+"",R=t[3].table.rows,A=[];for(let a=0;a<R.length;a+=1)A[a]=pt(mt(t,R,a));const Q=t=>m(A[t],1,1,(()=>{A[t]=null}));let q=Object.entries(U),H=[];for(let a=0;a<q.length;a+=1)H[a]=bt(ht(t,q,a));return{c(){e=a("h1"),n=g(S),o=y(),l=a("div");for(let t=0;t<A.length;t+=1)A[t].c();u=y(),d=a("div"),$=a("form"),x=a("div"),w=a("select");for(let t=0;t<H.length;t+=1)H[t].c();E=y(),_=a("div"),T=a("button"),D=g("Create"),this.h()},l(t){e=r(t,"H1",{});var a=s(e);n=v(a,S),a.forEach(c),o=I(t),l=r(t,"DIV",{class:!0});var i=s(l);for(let e=0;e<A.length;e+=1)A[e].l(i);i.forEach(c),u=I(t),d=r(t,"DIV",{class:!0});var f=s(d);$=r(f,"FORM",{action:!0,class:!0});var h=s($);x=r(h,"DIV",{class:!0});var m=s(x);w=r(m,"SELECT",{class:!0,placeholder:!0,"aria-label":!0,required:!0});var p=s(w);for(let e=0;e<H.length;e+=1)H[e].l(p);p.forEach(c),m.forEach(c),E=I(h),_=r(h,"DIV",{class:!0});var b=s(_);T=r(b,"BUTTON",{type:!0,class:!0,"aria-label":!0});var g=s(T);D=v(g,"Create"),g.forEach(c),b.forEach(c),h.forEach(c),f.forEach(c),this.h()},h(){f(l,"class","mt-4"),f(w,"class","form-select"),f(w,"placeholder","New Book Name"),f(w,"aria-label","New Book Name"),w.required=!0,void 0===t[2]&&C((()=>t[5].call(w))),f(x,"class","col-auto"),f(T,"type","submit"),f(T,"class","btn btn-primary"),f(T,"aria-label","Create Block"),f(_,"class","col-auto"),f($,"action","javascript:void(0);"),f($,"class","row mt-4"),f(d,"class","d-flex align-items-center justify-content-center")},m(a,r){i(a,e,r),k(e,n),i(a,o,r),i(a,l,r);for(let t=0;t<A.length;t+=1)A[t].m(l,null);i(a,u,r),i(a,d,r),k(d,$),k($,x),k(x,w);for(let t=0;t<H.length;t+=1)H[t].m(w,null);P(w,t[2]),k($,E),k($,_),k(_,T),k(T,D),j=!0,M||(N=[V(w,"change",t[5]),V(T,"click",t[4])],M=!0)},p(t,[e]){if((!j||1&e)&&S!==(S=t[0].name+"")&&O(n,S),10&e){let n;for(R=t[3].table.rows,n=0;n<R.length;n+=1){const o=mt(t,R,n);A[n]?(A[n].p(o,e),b(A[n],1)):(A[n]=pt(o),A[n].c(),b(A[n],1),A[n].m(l,null))}for(h(),n=R.length;n<A.length;n+=1)Q(n);p()}if(0&e){let n;for(q=Object.entries(U),n=0;n<q.length;n+=1){const o=ht(t,q,n);H[n]?H[n].p(o,e):(H[n]=bt(o),H[n].c(),H[n].m(w,null))}for(;n<H.length;n+=1)H[n].d(1);H.length=q.length}4&e&&P(w,t[2])},i(t){if(!j){for(let t=0;t<R.length;t+=1)b(A[t]);j=!0}},o(t){A=A.filter(Boolean);for(let e=0;e<A.length;e+=1)m(A[e]);j=!1},d(t){t&&c(e),t&&c(o),t&&c(l),B(A,t),t&&c(u),t&&c(d),B(H,t),M=!1,L(N)}}}function vt(e,n,o){let a;M(e,Y,(t=>o(3,a=t)));let{book:r}=n,{room:s}=n,c=U.Text;return e.$$set=t=>{"book"in t&&o(0,r=t.book),"room"in t&&o(1,s=t.room)},[r,s,c,a,function(){!function(e,n){let o;Y.change((({table:a})=>{const r={bookId:e,type:n};W(r)&&(r.text=new t.Text),o=a.add(r)}))}(r.id,c)},function(){c=N(this),o(2,c)}]}class kt extends e{constructor(t){super(),n(this,t,vt,gt,o,{book:0,room:1})}}const $t=S(null),xt={subscribe:$t.subscribe,get:()=>R($t)},wt=[];function yt(t){return`com-books-aicacia-${t}`}function Et(t){let e,n;return{c(){e=a("div"),n=a("span"),this.h()},l(t){e=r(t,"DIV",{class:!0});var o=s(e);n=r(o,"SPAN",{class:!0,role:!0,"aria-hidden":!0}),s(n).forEach(c),o.forEach(c),this.h()},h(){f(n,"class","spinner-border spinner-border-sm"),f(n,"role","status"),f(n,"aria-hidden","true"),f(e,"class","d-flex align-items-center justify-content-center")},m(t,o){i(t,e,o),k(e,n)},p:l,i:l,o:l,d(t){t&&c(e)}}}function It(t){let e,n;return e=new kt({props:{book:t[1],room:t[0]}}),{c(){w(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,o){_(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.book=t[1]),1&n&&(o.room=t[0]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){m(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}function _t(t){var e;let n,o,a,r,s,l;document.title=n="Book: "+(null==(e=t[1])?void 0:e.name);const u=[It,Et],d=[];function f(t,e){return t[1]?0:1}return a=f(t),r=d[a]=u[a](t),{c(){o=y(),r.c(),s=x()},l(t){A('[data-svelte="svelte-1ansdeq"]',document.head).forEach(c),o=I(t),r.l(t),s=x()},m(t,e){i(t,o,e),d[a].m(t,e),i(t,s,e),l=!0},p(t,[e]){var o;(!l||2&e)&&n!==(n="Book: "+(null==(o=t[1])?void 0:o.name))&&(document.title=n);let c=a;a=f(t),a===c?d[a].p(t,e):(h(),m(d[c],1,1,(()=>{d[c]=null})),p(),r=d[a],r?r.p(t,e):(r=d[a]=u[a](t),r.c()),b(r,1),r.m(s.parentNode,s))},i(t){l||(b(r),l=!0)},o(t){m(r),l=!1},d(t){t&&c(o),d[a].d(t),t&&c(s)}}}async function Tt({page:{params:t}}){return{props:{bookId:t.bookId}}}function Dt(e,n,o){let a,r,s,c;M(e,F,(t=>o(3,r=t))),M(e,Y,(t=>o(4,s=t))),M(e,xt,(t=>o(5,c=t)));var i=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(a,r){function s(t){try{i(o.next(t))}catch(e){r(e)}}function c(t){try{i(o.throw(t))}catch(e){r(e)}}function i(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}i((o=o.apply(t,e||[])).next())}))};let l,{bookId:d}=n;function f(e){console.log(e),"book"===e.type?(F.change((({table:t})=>{t.add(z(e.payload.book))})),Y.change((({table:n})=>{e.payload.blocks.forEach((e=>{n.add(function(e){const n={id:e.id,bookId:e.bookId,type:e.type};W(n)&&(n.text=new t.Text(e.text));return n}(e))}))}))):"get-book"===e.type&&a&&l.send(e.from,"book",{book:G(a),blocks:s.table.filter((t=>t.bookId===d)).map(X)})}function h(){a?l.off("connection",h):l.broadcast("get-book",void 0)}return u((()=>i(void 0,void 0,void 0,(function*(){const t=yield new Promise((t=>xt.get()?t(xt.get()):wt.push(t)));o(0,l=yield t.connectToRoom(yt(d))),l.on("message",f),l.on("connection",h)})))),Q((()=>{null==c||c.disconnectFromRoom(l.getRoomId())})),e.$$set=t=>{"bookId"in t&&o(2,d=t.bookId)},e.$$.update=()=>{12&e.$$.dirty&&o(1,a=r.table.rows.find((t=>t.id===d)))},[l,a,d,r]}"object"==typeof window&&async function(){const{Peer:t}=await J((()=>import("../../chunks/index-4cfba2de.js").then((function(t){return t.i}))),["/_app/chunks/index-4cfba2de.js","/_app/chunks/vendor-c9b40f2c.js"]),e=new t(new window.Peer(yt(await H())));$t.set(e),wt.forEach((t=>t(e))),wt.length=0}();export default class extends e{constructor(t){super(),n(this,t,Dt,_t,o,{bookId:2})}}export{Tt as load};
