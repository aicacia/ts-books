import{Q as t,S as n,i as e,s as o,e as a,c as i,a as r,d as s,f as c,I as l,z as u,V as d,b as f,B as h,r as m,u as p,v as b,t as g,g as v,G as k,D as $,l as x,j as y,k as w,m as E,n as _,o as T,w as D,W as I,L as V,X as j,Y as C,Z as U,h as P,M as O,N as B,O as L,_ as M,C as N,R as S,J as R,$ as A}from"../../chunks/vendor-c9b40f2c.js";import{p as Q,g as q,b as H,a as F,d as z}from"../../chunks/books-9494bd7f.js";import{_ as G}from"../../chunks/preload-helper-9f12a5fd.js";var J;function W(t){return null!==t&&"object"==typeof t&&t.type===J.Text}function X(t){const n={uuid:t.uuid,bookUuid:t.bookUuid,type:t.type};if(W(t)){n.text=t.text.toString()}return n}(J||(J={})).Text="text";const Y=Q("blocks",{table:new t.Table});function Z(t,n){Y.change((({table:e})=>{const o=e.rows.find((n=>n.uuid===t));o&&n(o)}))}function K(t){let n;return{c(){n=a("div")},l(t){n=i(t,"DIV",{}),r(n).forEach(s)},m(e,o){c(e,n,o),t[6](n)},p:l,i:l,o:l,d(e){e&&s(n),t[6](null)}}}function tt(t,n,e){var o=this&&this.__awaiter||function(t,n,e,o){return new(e||(e=Promise))((function(a,i){function r(t){try{c(o.next(t))}catch(n){i(n)}}function s(t){try{c(o.throw(t))}catch(n){i(n)}}function c(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,s)}c((o=o.apply(t,n||[])).next())}))};let a,i,r,{text:s}=n,{onTextChange:c}=n,{onQuillMount:l}=n;return u((()=>o(void 0,void 0,void 0,(function*(){const{default:t}=yield G((()=>import("../../chunks/quill-23a75ab1.js").then((function(t){return t.q}))),["/_app/chunks/quill-23a75ab1.js","/_app/chunks/vendor-c9b40f2c.js"]);e(5,i=new t(r,{modules:{toolbar:!1},theme:"snow"})),s&&i.setText(s),i.on("text-change",(function(t,n,e){"user"===e&&c(t)})),r.addEventListener("keydown",(function(t){if("Backspace"===t.key){const n=i.getText();""!==n&&"\n"!==n&&t.stopPropagation()}}),{capture:!0}),l&&l(i)})))),t.$$set=t=>{"text"in t&&e(1,s=t.text),"onTextChange"in t&&e(2,c=t.onTextChange),"onQuillMount"in t&&e(3,l=t.onQuillMount)},t.$$.update=()=>{50&t.$$.dirty&&s!==a&&i&&(e(4,a=s),i.setText(s))},[r,s,c,l,a,i,function(t){d[t?"unshift":"push"]((()=>{r=t,e(0,r)}))}]}class nt extends n{constructor(t){super(),e(this,t,tt,K,o,{text:1,onTextChange:2,onQuillMount:3})}}function et(t){let n,e,o;return{c(){n=a("div"),e=a("h1"),o=g("Click to Edit"),this.h()},l(t){n=i(t,"DIV",{class:!0});var a=r(n);e=i(a,"H1",{});var c=r(e);o=v(c,"Click to Edit"),c.forEach(s),a.forEach(s),this.h()},h(){f(n,"class","d-flex align-items-center justify-content-center")},m(t,a){c(t,n,a),k(n,e),k(e,o)},p:l,i:l,o:l,d(t){t&&s(n)}}}function ot(t){let n,e,o=$.markdown(t[2])+"";return{c(){e=x(),this.h()},l(t){e=x(),this.h()},h(){n=new I(e)},m(t,a){n.m(o,t,a),c(t,e,a)},p(t,e){4&e&&o!==(o=$.markdown(t[2])+"")&&n.p(o)},i:l,o:l,d(t){t&&s(e),t&&n.d()}}}function at(t){let n,e,o,l,u,d,h=$.markdown(t[3])+"";return o=new nt({props:{text:t[2],onTextChange:t[5],onQuillMount:t[4]}}),{c(){n=a("div"),e=a("div"),y(o.$$.fragment),l=w(),u=a("div"),this.h()},l(t){n=i(t,"DIV",{class:!0});var a=r(n);e=i(a,"DIV",{class:!0});var c=r(e);E(o.$$.fragment,c),c.forEach(s),l=_(a),u=i(a,"DIV",{class:!0}),r(u).forEach(s),a.forEach(s),this.h()},h(){f(e,"class","col-6"),f(u,"class","col-6"),f(n,"class","row")},m(t,a){c(t,n,a),k(n,e),T(o,e,null),k(n,l),k(n,u),u.innerHTML=h,d=!0},p(t,n){const e={};4&n&&(e.text=t[2]),o.$set(e),(!d||8&n)&&h!==(h=$.markdown(t[3])+"")&&(u.innerHTML=h)},i(t){d||(b(o.$$.fragment,t),d=!0)},o(t){m(o.$$.fragment,t),d=!1},d(t){t&&s(n),D(o)}}}function it(t){let n,e,o,l,u,d;const g=[at,ot,et],v=[];function k(t,n){return t[1]?0:(4&n&&(e=!!t[2].trim()),e?1:2)}return o=k(t,-1),l=v[o]=g[o](t),{c(){n=a("div"),l.c(),this.h()},l(t){n=i(t,"DIV",{id:!0});var e=r(n);l.l(e),e.forEach(s),this.h()},h(){f(n,"id",u=t[0].uuid)},m(t,e){c(t,n,e),v[o].m(n,null),d=!0},p(t,[e]){let a=o;o=k(t,e),o===a?v[o].p(t,e):(h(),m(v[a],1,1,(()=>{v[a]=null})),p(),l=v[o],l?l.p(t,e):(l=v[o]=g[o](t),l.c()),b(l,1),l.m(n,null)),(!d||1&e&&u!==(u=t[0].uuid))&&f(n,"id",u)},i(t){d||(b(l),d=!0)},o(t){m(l),d=!1},d(t){t&&s(n),v[o].d()}}}function rt(t,n){let e=0;for(let o of n)if(o.retain&&(e+=o.retain),"string"==typeof o.insert){const n=o.insert.split("");t.insertAt(e,...n),e+=n.length}else o.delete&&t.deleteAt(e,o.delete)}function st(t,n,e){var o=this&&this.__awaiter||function(t,n,e,o){return new(e||(e=Promise))((function(a,i){function r(t){try{c(o.next(t))}catch(n){i(n)}}function s(t){try{c(o.throw(t))}catch(n){i(n)}}function c(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,s)}c((o=o.apply(t,n||[])).next())}))};let a,i,r,{block:s}=n,{edit:c}=n,{room:l}=n,d=l,f=s.text.toString(),h=f;function m(t){"edit-text-block"===t.type&&t.payload.uuid===s.uuid&&Z(s.uuid,(n=>{rt(n.text,t.payload.ops),c?(null==r||r.updateContents(new a(t.payload.ops),"api"),e(3,h=n.text.toString())):e(2,f=n.text.toString())}))}return u((()=>o(void 0,void 0,void 0,(function*(){const{default:t}=yield G((()=>import("../../chunks/Delta-2477219f.js").then((function(t){return t.D}))),["/_app/chunks/Delta-2477219f.js","/_app/chunks/vendor-c9b40f2c.js"]);a=t})))),t.$$set=t=>{"block"in t&&e(0,s=t.block),"edit"in t&&e(1,c=t.edit),"room"in t&&e(6,l=t.room)},t.$$.update=()=>{263&t.$$.dirty&&c!==i&&(e(8,i=c),e(2,f=s.text.toString()),e(3,h=f)),192&t.$$.dirty&&d!==l&&(null==d||d.off("message",m),null==l||l.on("message",m),e(7,d=l))},[s,c,f,h,function(t){r=t},function(t){Z(s.uuid,(n=>{null==l||l.broadcast("edit-text-block",{uuid:n.uuid,ops:t.ops}),rt(n.text,t.ops),e(3,h=n.text.toString())}))},l,d,i]}class ct extends n{constructor(t){super(),e(this,t,st,it,o,{block:0,edit:1,room:6})}}function lt(t){let n,e;return n=new ct({props:{block:t[0],edit:t[2],room:t[1]}}),{c(){y(n.$$.fragment)},l(t){E(n.$$.fragment,t)},m(t,o){T(n,t,o),e=!0},p(t,e){const o={};1&e&&(o.block=t[0]),4&e&&(o.edit=t[2]),2&e&&(o.room=t[1]),n.$set(o)},i(t){e||(b(n.$$.fragment,t),e=!0)},o(t){m(n.$$.fragment,t),e=!1},d(t){D(n,t)}}}function ut(t){let n,e,o,l,u=t[0].type===J.Text&&lt(t);return{c(){n=a("div"),u&&u.c(),this.h()},l(t){n=i(t,"DIV",{class:!0});var e=r(n);u&&u.l(e),e.forEach(s),this.h()},h(){f(n,"class","mb-4")},m(a,i){c(a,n,i),u&&u.m(n,null),e=!0,o||(l=V(n,"click",j(t[3])),o=!0)},p(t,[e]){t[0].type===J.Text?u?(u.p(t,e),1&e&&b(u,1)):(u=lt(t),u.c(),b(u,1),u.m(n,null)):u&&(h(),m(u,1,1,(()=>{u=null})),p())},i(t){e||(b(u),e=!0)},o(t){m(u),e=!1},d(t){t&&s(n),u&&u.d(),o=!1,l()}}}function dt(t,n,e){let o,{block:a}=n,{room:i}=n;u((()=>{window.addEventListener("click",(()=>e(2,o=!1)))}));return t.$$set=t=>{"block"in t&&e(0,a=t.block),"room"in t&&e(1,i=t.room)},[a,i,o,()=>e(2,o=!0)]}class ft extends n{constructor(t){super(),e(this,t,dt,ut,o,{block:0,room:1})}}function ht(t,n,e){const o=t.slice();return o[6]=n[e][0],o[7]=n[e][1],o}function mt(t,n,e){const o=t.slice();return o[10]=n[e],o}function pt(t){let n,e;return n=new ft({props:{block:t[10],room:t[1]}}),{c(){y(n.$$.fragment)},l(t){E(n.$$.fragment,t)},m(t,o){T(n,t,o),e=!0},p(t,e){const o={};8&e&&(o.block=t[10]),2&e&&(o.room=t[1]),n.$set(o)},i(t){e||(b(n.$$.fragment,t),e=!0)},o(t){m(n.$$.fragment,t),e=!1},d(t){D(n,t)}}}function bt(t){let n,e,o=t[6]+"";return{c(){n=a("option"),e=g(o),this.h()},l(t){n=i(t,"OPTION",{value:!0});var a=r(n);e=v(a,o),a.forEach(s),this.h()},h(){n.__value=t[7],n.value=n.__value},m(t,o){c(t,n,o),k(n,e)},p:l,d(t){t&&s(n)}}}function gt(t){let n,e,o,l,u,d,$,x,y,E,T,D,I,j,L,M,N=t[0].name+"",S=t[3].table.rows,R=[];for(let a=0;a<S.length;a+=1)R[a]=pt(mt(t,S,a));const A=t=>m(R[t],1,1,(()=>{R[t]=null}));let Q=Object.entries(J),q=[];for(let a=0;a<Q.length;a+=1)q[a]=bt(ht(t,Q,a));return{c(){n=a("h1"),e=g(N),o=w(),l=a("div");for(let t=0;t<R.length;t+=1)R[t].c();u=w(),d=a("div"),$=a("form"),x=a("div"),y=a("select");for(let t=0;t<q.length;t+=1)q[t].c();E=w(),T=a("div"),D=a("button"),I=g("Create"),this.h()},l(t){n=i(t,"H1",{});var a=r(n);e=v(a,N),a.forEach(s),o=_(t),l=i(t,"DIV",{class:!0});var c=r(l);for(let n=0;n<R.length;n+=1)R[n].l(c);c.forEach(s),u=_(t),d=i(t,"DIV",{class:!0});var f=r(d);$=i(f,"FORM",{action:!0,class:!0});var h=r($);x=i(h,"DIV",{class:!0});var m=r(x);y=i(m,"SELECT",{class:!0,placeholder:!0,"aria-label":!0,required:!0});var p=r(y);for(let n=0;n<q.length;n+=1)q[n].l(p);p.forEach(s),m.forEach(s),E=_(h),T=i(h,"DIV",{class:!0});var b=r(T);D=i(b,"BUTTON",{type:!0,class:!0,"aria-label":!0});var g=r(D);I=v(g,"Create"),g.forEach(s),b.forEach(s),h.forEach(s),f.forEach(s),this.h()},h(){f(l,"class","mt-4"),f(y,"class","form-select"),f(y,"placeholder","New Book Name"),f(y,"aria-label","New Book Name"),y.required=!0,void 0===t[2]&&C((()=>t[5].call(y))),f(x,"class","col-auto"),f(D,"type","submit"),f(D,"class","btn btn-primary"),f(D,"aria-label","Create Block"),f(T,"class","col-auto"),f($,"action","javascript:void(0);"),f($,"class","row mt-4"),f(d,"class","d-flex align-items-center justify-content-center")},m(a,i){c(a,n,i),k(n,e),c(a,o,i),c(a,l,i);for(let t=0;t<R.length;t+=1)R[t].m(l,null);c(a,u,i),c(a,d,i),k(d,$),k($,x),k(x,y);for(let t=0;t<q.length;t+=1)q[t].m(y,null);U(y,t[2]),k($,E),k($,T),k(T,D),k(D,I),j=!0,L||(M=[V(y,"change",t[5]),V(D,"click",t[4])],L=!0)},p(t,[n]){if((!j||1&n)&&N!==(N=t[0].name+"")&&P(e,N),10&n){let e;for(S=t[3].table.rows,e=0;e<S.length;e+=1){const o=mt(t,S,e);R[e]?(R[e].p(o,n),b(R[e],1)):(R[e]=pt(o),R[e].c(),b(R[e],1),R[e].m(l,null))}for(h(),e=S.length;e<R.length;e+=1)A(e);p()}if(0&n){let e;for(Q=Object.entries(J),e=0;e<Q.length;e+=1){const o=ht(t,Q,e);q[e]?q[e].p(o,n):(q[e]=bt(o),q[e].c(),q[e].m(y,null))}for(;e<q.length;e+=1)q[e].d(1);q.length=Q.length}4&n&&U(y,t[2])},i(t){if(!j){for(let t=0;t<S.length;t+=1)b(R[t]);j=!0}},o(t){R=R.filter(Boolean);for(let n=0;n<R.length;n+=1)m(R[n]);j=!1},d(t){t&&s(n),t&&s(o),t&&s(l),O(R,t),t&&s(u),t&&s(d),O(q,t),L=!1,B(M)}}}function vt(n,e,o){let a;L(n,Y,(t=>o(3,a=t)));let{book:i}=e,{room:r}=e,s=J.Text;return n.$$set=t=>{"book"in t&&o(0,i=t.book),"room"in t&&o(1,r=t.room)},[i,r,s,a,function(){!function(n,e){const o=t.uuid();Y.change((({table:a})=>{const i={uuid:o,bookUuid:n,type:e};W(i)&&(i.text=new t.Text),a.add(i)}))}(i.uuid,s)},function(){s=M(this),o(2,s)}]}class kt extends n{constructor(t){super(),e(this,t,vt,gt,o,{book:0,room:1})}}const $t=N(null),xt={subscribe:$t.subscribe,get:()=>S($t)},yt=[];function wt(t){return`com-books-aicacia-${t}`}function Et(t){let n,e;return{c(){n=a("div"),e=a("span"),this.h()},l(t){n=i(t,"DIV",{class:!0});var o=r(n);e=i(o,"SPAN",{class:!0,role:!0,"aria-hidden":!0}),r(e).forEach(s),o.forEach(s),this.h()},h(){f(e,"class","spinner-border spinner-border-sm"),f(e,"role","status"),f(e,"aria-hidden","true"),f(n,"class","d-flex align-items-center justify-content-center")},m(t,o){c(t,n,o),k(n,e)},p:l,i:l,o:l,d(t){t&&s(n)}}}function _t(t){let n,e;return n=new kt({props:{book:t[1],room:t[0]}}),{c(){y(n.$$.fragment)},l(t){E(n.$$.fragment,t)},m(t,o){T(n,t,o),e=!0},p(t,e){const o={};2&e&&(o.book=t[1]),1&e&&(o.room=t[0]),n.$set(o)},i(t){e||(b(n.$$.fragment,t),e=!0)},o(t){m(n.$$.fragment,t),e=!1},d(t){D(n,t)}}}function Tt(t){var n;let e,o,a,i,r,l;document.title=e="Book: "+(null==(n=t[1])?void 0:n.name);const u=[_t,Et],d=[];function f(t,n){return t[1]?0:1}return a=f(t),i=d[a]=u[a](t),{c(){o=w(),i.c(),r=x()},l(t){R('[data-svelte="svelte-1ansdeq"]',document.head).forEach(s),o=_(t),i.l(t),r=x()},m(t,n){c(t,o,n),d[a].m(t,n),c(t,r,n),l=!0},p(t,[n]){var o;(!l||2&n)&&e!==(e="Book: "+(null==(o=t[1])?void 0:o.name))&&(document.title=e);let s=a;a=f(t),a===s?d[a].p(t,n):(h(),m(d[s],1,1,(()=>{d[s]=null})),p(),i=d[a],i?i.p(t,n):(i=d[a]=u[a](t),i.c()),b(i,1),i.m(r.parentNode,r))},i(t){l||(b(i),l=!0)},o(t){m(i),l=!1},d(t){t&&s(o),d[a].d(t),t&&s(r)}}}async function Dt({page:{params:t}}){return{props:{bookUuid:t.bookUuid}}}function It(n,e,o){let a,i,r,s;L(n,H,(t=>o(3,i=t))),L(n,Y,(t=>o(4,r=t))),L(n,xt,(t=>o(5,s=t)));var c=this&&this.__awaiter||function(t,n,e,o){return new(e||(e=Promise))((function(a,i){function r(t){try{c(o.next(t))}catch(n){i(n)}}function s(t){try{c(o.throw(t))}catch(n){i(n)}}function c(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,s)}c((o=o.apply(t,n||[])).next())}))};let l,{bookUuid:d}=e;function f(n){"sync"===n.type?(H.change((({table:t})=>{t.add(F(n.payload.book))})),Y.change((({table:e})=>{n.payload.blocks.forEach((n=>{e.add(function(n){const e={uuid:n.uuid,bookUuid:n.bookUuid,type:n.type};W(e)&&(e.text=new t.Text(n.text));return e}(n))}))})),l.off("connection",h)):"sync-book"===n.type&&a&&l.send(n.from,"sync",{book:z(a),blocks:r.table.filter((t=>t.bookUuid===d)).map(X)})}function h(){l.broadcast("sync-book",void 0)}return u((()=>c(void 0,void 0,void 0,(function*(){const t=yield new Promise((t=>xt.get()?t(xt.get()):yt.push(t)));o(0,l=yield t.connectToRoom(wt(d))),l.on("message",f),l.on("connection",h)})))),A((()=>{null==s||s.disconnectFromRoom(l.getRoomId())})),n.$$set=t=>{"bookUuid"in t&&o(2,d=t.bookUuid)},n.$$.update=()=>{12&n.$$.dirty&&o(1,a=i.table.rows.find((t=>t.uuid===d)))},[l,a,d,i]}"object"==typeof window&&async function(){const{Peer:t}=await G((()=>import("../../chunks/index-4cfba2de.js").then((function(t){return t.i}))),["/_app/chunks/index-4cfba2de.js","/_app/chunks/vendor-c9b40f2c.js"]),n=new t(new window.Peer(wt(await q())));$t.set(n),yt.forEach((t=>t(n))),yt.length=0}();export default class extends n{constructor(t){super(),e(this,t,It,Tt,o,{bookUuid:2})}}export{Dt as load};
