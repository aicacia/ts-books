import{C as t,N as s,O as e,P as i,Q as r}from"./vendor-e656a39c.js";class a{constructor(e,i,r=5e3){this.initialized=!1,this.updaters=[],this.name=e,this.store=t(i),this.init(),this.debouncedPersist=s.debounce(this.persist,r)}async init(){const t=await e.getItem({key:this.name})();t&&this.store.set(JSON.parse(t));const s=this.updaters.slice();this.updaters.length=0,s.forEach((t=>this.store.update(t))),this.debouncedPersist(),this.initialized=!0}async persist(){await e.setItem({key:this.name,value:JSON.stringify(this.get())})()}get(){return i(this.store)}set(t){return this.update((()=>t)),this}update(t){return this.initialized?(this.store.update(t),this.debouncedPersist()):this.updaters.push(t),this}subscribe(t,s){return this.store.subscribe(t,s)}}function n(t,s,e=5e3){return new a(t,s,e)}const h=n("books",{byId:{}});function o(t){const s={id:r.v4(),name:t};h.update((t=>(t.byId[s.id]=s,t)))}export{h as b,o as c,n as p};
